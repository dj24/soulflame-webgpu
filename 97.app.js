(()=>{var t,e,r={192:(t,e,r)=>{"use strict";var i=r(491),o=r(590),s=r(391),n=r.n(s),l=r(627);const a=n()("crystals3"),c=(0,l.Cf)(a),h=(t,e,r,i=1,o=3,s=.5)=>{let n=0,l=0,a=1;for(let h=0;h<o;h++){const o=1<<h;l+=c(t*o*i,e*o*i,r*o*i)*a,n+=a,a*=s}return l/n};function f(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}const u=(t,e)=>e[0]+e[1]*t[0]+e[2]*(t[0]*t[1]);class d{cache;size;getVoxel;constructor(t,e){this.size=e,this.getVoxel=t,this.cache=new Uint8Array(e[0]*e[1]*e[2]*4);let r=!0;for(let i=0;i<e[0];i++)for(let o=0;o<e[1];o++)for(let s=0;s<e[2];s++){const n=u(e,[i,o,s]),l=t(i,o,s);null!==l?(this.cache[4*n]=l.red,this.cache[4*n+1]=l.green,this.cache[4*n+2]=l.blue):r=!1}if(r)for(let t=0;t<e[0];t++)for(let r=0;r<e[1];r++)for(let i=0;i<e[2];i++){const o=u(e,[t,r,i]);this.cache[4*o+4]=1}}get buffer(){return this.cache.buffer}get([t,e,r]){const i=u(this.size,[t,e,r]),o=this.cache[4*i],s=this.cache[4*i+1],n=this.cache[4*i+2],l=1===this.cache[4*i+3];return 0===o&&0===s&&0===n?null:{red:o,green:s,blue:n,solid:l}}}var p=r(300);let g,x;const b={createOctreeAndReturnBytes:async(t,e,r)=>{const o=new d(((e,r,i)=>((t,e,r,i)=>{const o=(0+e)/256;if(f((h(t,e,r,.008,3)+1)/2)<o)return null;if(f((h(t,e,r,.001,5)+1)/2)>o){const t=p.eR.lerp([0,255-128*a(),0],[72-16*a(),48,42],Math.max(0,0));return{red:t[0],green:t[1],blue:t[2],solid:!0}}return null})(e+t[0],r+t[1],i+t[2])),e),s=Math.log2(Math.max(...e));x=[o];for(let t=s-1;t>=0;t--){const r=Math.ceil(e[0]/Math.pow(2,s-t)),i=new d(((t,e,r)=>{const i=2*Math.floor(t/2),o=2*Math.floor(e/2),s=2*Math.floor(r/2);let n=0,l=0,a=0,c=0,h=0;for(let t=0;t<2;t++)for(let e=0;e<2;e++)for(let r=0;r<2;r++){const f=x[0].get([i+t,o+e,s+r]);f&&(n+=f.red,l+=f.green,a+=f.blue,c++,f.solid&&h++)}return 0===c?null:{red:n/c,green:l/c,blue:a/c,solid:8===h}}),[r,r,r]);x.unshift(i)}return g=new i.xV(((t,e,r,i)=>x[i].get([t,e,r])),(()=>1),Math.max(...e),r),g.totalSizeBytes+i.ps}};(0,o.p)(b)},491:(t,e,r)=>{"use strict";r.d(e,{ps:()=>i,xV:()=>s});const i=8,o=t=>[1&t?1:0,2&t?1:0,4&t?1:0];class s{nodes;#t;#e;#r;#i;#o;depth;constructor(t,e,r,i){this.nodes=[],this.#t=0,this.#i=new DataView(i),this.#e=t,this.#r=e,this.depth=Math.log2(r),this.#o=r,this.#s(0,[0,0,0],0)}#n(t=8){return this.#t+=t,this.#t-(t-1)}#s(t,e,r){const i=(s=2**(this.depth-r),Math.pow(2,Math.ceil(Math.log2(s))));var s;const a=[e[0]*i,e[1]*i,e[2]*i],c=this.#e(e[0],e[1],e[2],r);if(i<=this.#r(a[0],a[1],a[2])){const{red:r,green:o,blue:s}=c,l={red:r,green:o,blue:s,x:e[0]*i,y:e[1]*i,z:e[2]*i,size:i};return void n(this.#i,t,l)}const h=Array.from({length:8},(()=>0)),f=i/2;for(let t=0;t<8;t++){const r=o(t),s=e[0]*i+r[0]*f,n=e[1]*i+r[1]*f,l=e[2]*i+r[2]*f;for(let e=s;e<s+f;e++)for(let r=n;r<n+f;r++)for(let i=l;i<l+f;i++)this.#e(e,r,i,this.depth)&&h[t]++}let u=0,d=Array.from({length:8},(()=>!1));for(let t=0;t<8;t++){const i=o(t),s=e.map((t=>2*t)),n=s[0]+i[0],l=s[1]+i[1],a=s[2]+i[2];d[t]=null!==this.#e(n,l,a,r+1)}let p=Array.from({length:8},(()=>!1));const g=h.reduce(((t,e,r)=>e>0?(u=r+1,p[r]=!0,t|1<<r):t),0);if(i>64&&console.log(e[0],e[1],e[2],i,d,p,c),h.reduce(((t,e)=>t+e),0)===i**3){const r=a.map((t=>t+i/2)),{red:o,green:s,blue:l}=this.#e(r[0],r[1],r[2],this.depth),c={red:o,green:s,blue:l,x:e[0]*i,y:e[1]*i,z:e[2]*i,size:i};return void n(this.#i,t,c)}const x=this.#n(u),b=x-t;h.forEach(((t,i)=>{if(t){const t=x+i,s=o(i),n=2*e[0]+s[0],l=2*e[1]+s[1],a=2*e[2]+s[2];this.#s(t,[n,l,a],r+1)}}));const y={firstChildIndex:b,childMask:g,x:e[0]*i,y:e[1]*i,z:e[2]*i,size:i};l(this.#i,t,y)}get totalSizeBytes(){return this.#t*i}}const n=(t,e,r)=>{t.setUint8(e*i,0),t.setUint8(e*i+1,r.x),t.setUint8(e*i+2,r.y),t.setUint8(e*i+3,r.z),t.setUint8(e*i+4,r.red),t.setUint8(e*i+5,r.green),t.setUint8(e*i+6,r.blue),t.setUint8(e*i+7,Math.log2(r.size))},l=(t,e,r)=>{console.assert(r.firstChildIndex<2**24-1,`First child index of ${r.firstChildIndex} is too large to fit in 3 bytes`),console.assert(r.x<256,`X position of ${r.x} is too large to fit in 1 byte`),console.assert(r.y<256,`Y position of ${r.y} is too large to fit in 1 byte`),console.assert(r.z<256,`Z position of ${r.z} is too large to fit in 1 byte`),t.setUint8(e*i,r.childMask),t.setUint8(e*i+1,r.x),t.setUint8(e*i+2,r.y),t.setUint8(e*i+3,r.z),t.setUint32(e*i+4,r.firstChildIndex,!0),t.setUint8(e*i+7,Math.log2(r.size))}},234:()=>{}},i={};function o(t){var e=i[t];if(void 0!==e)return e.exports;var s=i[t]={id:t,loaded:!1,exports:{}};return r[t].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=r,o.x=()=>{var t=o.O(void 0,[381],(()=>o(192)));return o.O(t)},o.amdD=function(){throw new Error("define cannot be used indirect")},o.amdO={},t=[],o.O=(e,r,i,s)=>{if(!r){var n=1/0;for(h=0;h<t.length;h++){for(var[r,i,s]=t[h],l=!0,a=0;a<r.length;a++)(!1&s||n>=s)&&Object.keys(o.O).every((t=>o.O[t](r[a])))?r.splice(a--,1):(l=!1,s<n&&(n=s));if(l){t.splice(h--,1);var c=i();void 0!==c&&(e=c)}}return e}s=s||0;for(var h=t.length;h>0&&t[h-1][2]>s;h--)t[h]=t[h-1];t[h]=[r,i,s]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>t+".app.js",o.miniCssF=t=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=r[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={97:1};o.f.i=(e,r)=>{t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunksoulflame_webgpu=self.webpackChunksoulflame_webgpu||[],r=e.push.bind(e);e.push=e=>{var[i,s,n]=e;for(var l in s)o.o(s,l)&&(o.m[l]=s[l]);for(n&&n(o);i.length;)t[i.pop()]=1;r(e)}})(),e=o.x,o.x=()=>o.e(381).then(e),o.x()})();