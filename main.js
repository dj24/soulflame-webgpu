(()=>{var t={274:t=>{t.exports={size:[7,7,7],normalisedPivot:[2.2857143878936768,0,2.2857143878936768],bounds:{min:[0,0,0],max:[6,6,6]},voxels:[{position:[0,0,0],colour:[186,186,186,255]},{position:[0,0,1],colour:[186,186,186,255]},{position:[0,0,2],colour:[186,186,186,255]},{position:[0,0,3],colour:[186,186,186,255]},{position:[0,0,4],colour:[186,186,186,255]},{position:[0,0,5],colour:[186,186,186,255]},{position:[0,0,6],colour:[186,186,186,255]},{position:[0,1,0],colour:[31,115,38,255]},{position:[0,1,1],colour:[31,115,38,255]},{position:[0,1,2],colour:[31,115,38,255]},{position:[0,1,3],colour:[31,115,38,255]},{position:[0,1,4],colour:[31,115,38,255]},{position:[0,1,5],colour:[31,115,38,255]},{position:[0,1,6],colour:[31,115,38,255]},{position:[0,2,0],colour:[31,115,38,255]},{position:[0,2,1],colour:[31,115,38,255]},{position:[0,2,2],colour:[31,115,38,255]},{position:[0,2,3],colour:[31,115,38,255]},{position:[0,2,4],colour:[31,115,38,255]},{position:[0,2,5],colour:[31,115,38,255]},{position:[0,2,6],colour:[31,115,38,255]},{position:[0,3,0],colour:[31,115,38,255]},{position:[0,3,1],colour:[31,115,38,255]},{position:[0,3,2],colour:[31,115,38,255]},{position:[0,3,3],colour:[31,115,38,255]},{position:[0,3,4],colour:[31,115,38,255]},{position:[0,3,5],colour:[31,115,38,255]},{position:[0,3,6],colour:[31,115,38,255]},{position:[0,4,0],colour:[31,115,38,255]},{position:[0,4,1],colour:[31,115,38,255]},{position:[0,4,2],colour:[31,115,38,255]},{position:[0,4,3],colour:[31,115,38,255]},{position:[0,4,4],colour:[31,115,38,255]},{position:[0,4,5],colour:[31,115,38,255]},{position:[0,4,6],colour:[31,115,38,255]},{position:[0,5,0],colour:[31,115,38,255]},{position:[0,5,1],colour:[31,115,38,255]},{position:[0,5,2],colour:[31,115,38,255]},{position:[0,5,3],colour:[31,115,38,255]},{position:[0,5,4],colour:[31,115,38,255]},{position:[0,5,5],colour:[31,115,38,255]},{position:[0,5,6],colour:[31,115,38,255]},{position:[0,6,0],colour:[31,115,38,255]},{position:[0,6,1],colour:[31,115,38,255]},{position:[0,6,2],colour:[31,115,38,255]},{position:[0,6,3],colour:[31,115,38,255]},{position:[0,6,4],colour:[31,115,38,255]},{position:[0,6,5],colour:[31,115,38,255]},{position:[0,6,6],colour:[31,115,38,255]},{position:[1,0,0],colour:[186,186,186,255]},{position:[1,0,1],colour:[186,186,186,255]},{position:[1,0,2],colour:[186,186,186,255]},{position:[1,0,3],colour:[186,186,186,255]},{position:[1,0,4],colour:[186,186,186,255]},{position:[1,0,5],colour:[186,186,186,255]},{position:[1,0,6],colour:[186,186,186,255]},{position:[1,1,6],colour:[186,186,186,255]},{position:[1,2,6],colour:[186,186,186,255]},{position:[1,3,6],colour:[186,186,186,255]},{position:[1,4,6],colour:[186,186,186,255]},{position:[1,5,6],colour:[186,186,186,255]},{position:[1,6,0],colour:[186,186,186,255]},{position:[1,6,1],colour:[186,186,186,255]},{position:[1,6,2],colour:[186,186,186,255]},{position:[1,6,3],colour:[186,186,186,255]},{position:[1,6,4],colour:[186,186,186,255]},{position:[1,6,5],colour:[186,186,186,255]},{position:[1,6,6],colour:[186,186,186,255]},{position:[2,0,0],colour:[186,186,186,255]},{position:[2,0,1],colour:[186,186,186,255]},{position:[2,0,2],colour:[186,186,186,255]},{position:[2,0,3],colour:[186,186,186,255]},{position:[2,0,4],colour:[186,186,186,255]},{position:[2,0,5],colour:[186,186,186,255]},{position:[2,0,6],colour:[186,186,186,255]},{position:[2,1,6],colour:[186,186,186,255]},{position:[2,2,6],colour:[186,186,186,255]},{position:[2,3,6],colour:[186,186,186,255]},{position:[2,4,6],colour:[186,186,186,255]},{position:[2,5,6],colour:[186,186,186,255]},{position:[2,6,0],colour:[186,186,186,255]},{position:[2,6,1],colour:[186,186,186,255]},{position:[2,6,2],colour:[186,186,186,255]},{position:[2,6,3],colour:[186,186,186,255]},{position:[2,6,4],colour:[186,186,186,255]},{position:[2,6,5],colour:[186,186,186,255]},{position:[2,6,6],colour:[186,186,186,255]},{position:[3,0,0],colour:[186,186,186,255]},{position:[3,0,1],colour:[186,186,186,255]},{position:[3,0,2],colour:[186,186,186,255]},{position:[3,0,3],colour:[186,186,186,255]},{position:[3,0,4],colour:[186,186,186,255]},{position:[3,0,5],colour:[186,186,186,255]},{position:[3,0,6],colour:[186,186,186,255]},{position:[3,1,6],colour:[186,186,186,255]},{position:[3,2,6],colour:[186,186,186,255]},{position:[3,3,6],colour:[186,186,186,255]},{position:[3,4,6],colour:[186,186,186,255]},{position:[3,5,6],colour:[186,186,186,255]},{position:[3,6,0],colour:[186,186,186,255]},{position:[3,6,1],colour:[186,186,186,255]},{position:[3,6,2],colour:[186,186,186,255]},{position:[3,6,3],colour:[0,0,255,2]},{position:[3,6,4],colour:[186,186,186,255]},{position:[3,6,5],colour:[186,186,186,255]},{position:[3,6,6],colour:[186,186,186,255]},{position:[4,0,0],colour:[186,186,186,255]},{position:[4,0,1],colour:[186,186,186,255]},{position:[4,0,2],colour:[186,186,186,255]},{position:[4,0,3],colour:[186,186,186,255]},{position:[4,0,4],colour:[186,186,186,255]},{position:[4,0,5],colour:[186,186,186,255]},{position:[4,0,6],colour:[186,186,186,255]},{position:[4,1,6],colour:[186,186,186,255]},{position:[4,2,6],colour:[186,186,186,255]},{position:[4,3,6],colour:[186,186,186,255]},{position:[4,4,6],colour:[186,186,186,255]},{position:[4,5,6],colour:[186,186,186,255]},{position:[4,6,0],colour:[186,186,186,255]},{position:[4,6,1],colour:[186,186,186,255]},{position:[4,6,2],colour:[186,186,186,255]},{position:[4,6,3],colour:[186,186,186,255]},{position:[4,6,4],colour:[186,186,186,255]},{position:[4,6,5],colour:[186,186,186,255]},{position:[4,6,6],colour:[186,186,186,255]},{position:[5,0,0],colour:[186,186,186,255]},{position:[5,0,1],colour:[186,186,186,255]},{position:[5,0,2],colour:[186,186,186,255]},{position:[5,0,3],colour:[186,186,186,255]},{position:[5,0,4],colour:[186,186,186,255]},{position:[5,0,5],colour:[186,186,186,255]},{position:[5,0,6],colour:[186,186,186,255]},{position:[5,1,6],colour:[186,186,186,255]},{position:[5,2,6],colour:[186,186,186,255]},{position:[5,3,6],colour:[186,186,186,255]},{position:[5,4,6],colour:[186,186,186,255]},{position:[5,5,6],colour:[186,186,186,255]},{position:[5,6,0],colour:[186,186,186,255]},{position:[5,6,1],colour:[186,186,186,255]},{position:[5,6,2],colour:[186,186,186,255]},{position:[5,6,3],colour:[186,186,186,255]},{position:[5,6,4],colour:[186,186,186,255]},{position:[5,6,5],colour:[186,186,186,255]},{position:[5,6,6],colour:[186,186,186,255]},{position:[6,0,0],colour:[186,186,186,255]},{position:[6,0,1],colour:[186,186,186,255]},{position:[6,0,2],colour:[186,186,186,255]},{position:[6,0,3],colour:[186,186,186,255]},{position:[6,0,4],colour:[186,186,186,255]},{position:[6,0,5],colour:[186,186,186,255]},{position:[6,0,6],colour:[186,186,186,255]},{position:[6,1,0],colour:[166,13,13,255]},{position:[6,1,1],colour:[166,13,13,255]},{position:[6,1,2],colour:[166,13,13,255]},{position:[6,1,3],colour:[166,13,13,255]},{position:[6,1,4],colour:[166,13,13,255]},{position:[6,1,5],colour:[166,13,13,255]},{position:[6,1,6],colour:[166,13,13,255]},{position:[6,2,0],colour:[166,13,13,255]},{position:[6,2,1],colour:[166,13,13,255]},{position:[6,2,2],colour:[166,13,13,255]},{position:[6,2,3],colour:[166,13,13,255]},{position:[6,2,4],colour:[166,13,13,255]},{position:[6,2,5],colour:[166,13,13,255]},{position:[6,2,6],colour:[166,13,13,255]},{position:[6,3,0],colour:[166,13,13,255]},{position:[6,3,1],colour:[166,13,13,255]},{position:[6,3,2],colour:[166,13,13,255]},{position:[6,3,3],colour:[166,13,13,255]},{position:[6,3,4],colour:[166,13,13,255]},{position:[6,3,5],colour:[166,13,13,255]},{position:[6,3,6],colour:[166,13,13,255]},{position:[6,4,0],colour:[166,13,13,255]},{position:[6,4,1],colour:[166,13,13,255]},{position:[6,4,2],colour:[166,13,13,255]},{position:[6,4,3],colour:[166,13,13,255]},{position:[6,4,4],colour:[166,13,13,255]},{position:[6,4,5],colour:[166,13,13,255]},{position:[6,4,6],colour:[166,13,13,255]},{position:[6,5,0],colour:[166,13,13,255]},{position:[6,5,1],colour:[166,13,13,255]},{position:[6,5,2],colour:[166,13,13,255]},{position:[6,5,3],colour:[166,13,13,255]},{position:[6,5,4],colour:[166,13,13,255]},{position:[6,5,5],colour:[166,13,13,255]},{position:[6,5,6],colour:[166,13,13,255]},{position:[6,6,0],colour:[166,13,13,255]},{position:[6,6,1],colour:[166,13,13,255]},{position:[6,6,2],colour:[166,13,13,255]},{position:[6,6,3],colour:[166,13,13,255]},{position:[6,6,4],colour:[166,13,13,255]},{position:[6,6,5],colour:[166,13,13,255]},{position:[6,6,6],colour:[166,13,13,255]}],sliceFilePaths:["https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/0.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/1.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/2.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/3.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/4.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/5.png","https://dj24.github.io/soulflame-webgpu/voxel-models/cornell/6.png"],emissiveVoxels:[{position:[3,6,3],colour:[0,0,255,2]}]}},509:t=>{t.exports={size:[18,15,8],normalisedPivot:[.5,0,.5],bounds:{min:[0,0,0],max:[17,14,7]},voxels:[{position:[0,7,3],colour:[168,168,168,255]},{position:[0,8,3],colour:[168,168,168,255]},{position:[0,9,3],colour:[220,220,220,255]},{position:[0,10,3],colour:[220,220,220,255]},{position:[1,6,3],colour:[168,168,168,255]},{position:[1,7,3],colour:[68,68,68,255]},{position:[1,8,3],colour:[68,68,68,255]},{position:[1,9,3],colour:[68,68,68,255]},{position:[1,10,3],colour:[68,68,68,255]},{position:[1,11,3],colour:[220,220,220,255]},{position:[2,5,3],colour:[168,168,168,255]},{position:[2,7,3],colour:[116,116,116,255]},{position:[2,8,3],colour:[116,116,116,255]},{position:[2,9,3],colour:[168,168,168,255]},{position:[2,10,3],colour:[168,168,168,255]},{position:[2,12,3],colour:[220,220,220,255]},{position:[3,8,3],colour:[68,68,68,255]},{position:[3,9,3],colour:[68,68,68,255]},{position:[4,0,3],colour:[152,100,48,255]},{position:[4,1,3],colour:[152,100,48,255]},{position:[4,2,3],colour:[152,100,48,255]},{position:[4,3,3],colour:[152,100,48,255]},{position:[4,4,3],colour:[152,100,48,255]},{position:[4,5,3],colour:[152,100,48,255]},{position:[4,6,3],colour:[152,100,48,255]},{position:[4,7,3],colour:[152,100,48,255]},{position:[4,8,3],colour:[204,152,100,255]},{position:[4,9,3],colour:[68,68,68,255]},{position:[4,10,3],colour:[204,152,100,255]},{position:[5,3,3],colour:[252,204,152,255]},{position:[5,13,3],colour:[116,116,116,255]},{position:[5,14,3],colour:[136,136,136,255]},{position:[6,4,3],colour:[48,152,100,255]},{position:[6,8,2],colour:[116,116,116,255]},{position:[6,8,3],colour:[116,116,116,255]},{position:[6,8,4],colour:[116,116,116,255]},{position:[6,9,1],colour:[116,116,116,255]},{position:[6,9,3],colour:[116,116,116,255]},{position:[6,9,5],colour:[116,116,116,255]},{position:[6,10,1],colour:[116,116,116,255]},{position:[6,10,2],colour:[116,116,116,255]},{position:[6,10,4],colour:[116,116,116,255]},{position:[6,10,5],colour:[116,116,116,255]},{position:[6,11,1],colour:[116,116,116,255]},{position:[6,11,3],colour:[116,116,116,255]},{position:[6,11,5],colour:[116,116,116,255]},{position:[6,12,2],colour:[116,116,116,255]},{position:[6,12,3],colour:[116,116,116,255]},{position:[6,12,4],colour:[116,116,116,255]},{position:[6,13,3],colour:[116,116,116,255]},{position:[7,3,1],colour:[0,152,48,255]},{position:[7,3,2],colour:[48,204,48,255]},{position:[7,3,3],colour:[0,152,48,255]},{position:[7,3,4],colour:[48,204,48,255]},{position:[7,3,5],colour:[0,152,48,255]},{position:[7,5,2],colour:[252,152,0,255]},{position:[7,5,3],colour:[252,204,152,255]},{position:[7,6,2],colour:[252,152,0,255]},{position:[7,6,3],colour:[0,152,48,255]},{position:[7,6,4],colour:[252,152,0,255]},{position:[7,7,1],colour:[252,152,0,255]},{position:[7,7,3],colour:[252,152,0,255]},{position:[7,7,4],colour:[252,152,0,255]},{position:[7,7,5],colour:[252,152,0,255]},{position:[7,8,1],colour:[252,152,0,255]},{position:[7,8,2],colour:[252,204,48,255]},{position:[7,8,3],colour:[252,152,0,255]},{position:[7,8,4],colour:[252,152,0,255]},{position:[7,8,5],colour:[136,136,136,255]},{position:[7,9,1],colour:[252,152,0,255]},{position:[7,9,2],colour:[204,152,48,255]},{position:[7,9,3],colour:[252,152,0,255]},{position:[7,9,4],colour:[252,152,0,255]},{position:[7,9,5],colour:[252,152,0,255]},{position:[7,9,6],colour:[116,116,116,255]},{position:[7,10,0],colour:[168,168,168,255]},{position:[7,10,1],colour:[252,152,0,255]},{position:[7,10,2],colour:[252,152,0,255]},{position:[7,10,3],colour:[136,136,136,255]},{position:[7,10,4],colour:[252,152,0,255]},{position:[7,10,5],colour:[252,152,0,255]},{position:[7,10,6],colour:[116,116,116,255]},{position:[7,11,0],colour:[168,168,168,255]},{position:[7,11,1],colour:[252,152,0,255]},{position:[7,11,2],colour:[136,136,136,255]},{position:[7,11,3],colour:[252,152,0,255]},{position:[7,11,4],colour:[116,116,116,255]},{position:[7,11,5],colour:[252,152,0,255]},{position:[7,11,6],colour:[116,116,116,255]},{position:[7,12,1],colour:[116,116,116,255]},{position:[7,12,2],colour:[116,116,116,255]},{position:[7,12,3],colour:[116,116,116,255]},{position:[7,12,4],colour:[116,116,116,255]},{position:[7,12,5],colour:[116,116,116,255]},{position:[8,0,3],colour:[152,100,48,255]},{position:[8,1,3],colour:[152,100,48,255]},{position:[8,2,3],colour:[252,204,152,255]},{position:[8,3,1],colour:[48,204,48,255]},{position:[8,3,2],colour:[48,204,48,255]},{position:[8,3,3],colour:[252,152,0,255]},{position:[8,3,4],colour:[48,204,48,255]},{position:[8,3,5],colour:[48,204,48,255]},{position:[8,4,2],colour:[48,204,48,255]},{position:[8,4,3],colour:[0,152,48,255]},{position:[8,4,4],colour:[48,204,48,255]},{position:[8,5,2],colour:[48,204,48,255]},{position:[8,5,3],colour:[252,152,0,255]},{position:[8,5,4],colour:[48,204,48,255]},{position:[8,6,1],colour:[252,152,0,255]},{position:[8,6,2],colour:[252,152,0,255]},{position:[8,6,3],colour:[252,152,0,255]},{position:[8,6,4],colour:[252,152,0,255]},{position:[8,6,5],colour:[252,152,0,255]},{position:[8,7,2],colour:[252,152,100,255]},{position:[8,7,3],colour:[252,152,0,255]},{position:[8,7,4],colour:[252,152,0,255]},{position:[8,7,5],colour:[252,152,0,255]},{position:[8,7,6],colour:[252,152,0,255]},{position:[8,8,2],colour:[16,16,16,255]},{position:[8,8,3],colour:[252,152,0,255]},{position:[8,8,4],colour:[252,152,0,255]},{position:[8,8,5],colour:[252,152,0,255]},{position:[8,8,6],colour:[116,116,116,255]},{position:[8,8,7],colour:[116,116,116,255]},{position:[8,9,2],colour:[252,152,0,255]},{position:[8,9,3],colour:[252,152,0,255]},{position:[8,9,4],colour:[252,152,0,255]},{position:[8,9,5],colour:[252,152,0,255]},{position:[8,9,6],colour:[252,152,0,255]},{position:[8,9,7],colour:[116,116,116,255]},{position:[8,10,0],colour:[168,168,168,255]},{position:[8,10,1],colour:[136,136,136,255]},{position:[8,10,2],colour:[252,152,0,255]},{position:[8,10,3],colour:[252,152,0,255]},{position:[8,10,4],colour:[252,152,0,255]},{position:[8,10,5],colour:[252,152,0,255]},{position:[8,10,6],colour:[252,152,0,255]},{position:[8,10,7],colour:[116,116,116,255]},{position:[8,11,0],colour:[168,168,168,255]},{position:[8,11,1],colour:[252,152,0,255]},{position:[8,11,2],colour:[252,152,0,255]},{position:[8,11,3],colour:[252,152,0,255]},{position:[8,11,4],colour:[252,152,0,255]},{position:[8,11,5],colour:[252,152,0,255]},{position:[8,11,6],colour:[116,116,116,255]},{position:[8,12,1],colour:[136,136,136,255]},{position:[8,12,2],colour:[252,152,0,255]},{position:[8,12,3],colour:[252,152,0,255]},{position:[8,12,4],colour:[252,152,0,255]},{position:[8,12,5],colour:[116,116,116,255]},{position:[8,13,2],colour:[116,116,116,255]},{position:[8,13,3],colour:[116,116,116,255]},{position:[8,13,4],colour:[116,116,116,255]},{position:[9,3,1],colour:[0,152,48,255]},{position:[9,3,2],colour:[0,152,48,255]},{position:[9,3,3],colour:[0,152,48,255]},{position:[9,3,4],colour:[0,152,48,255]},{position:[9,3,5],colour:[0,152,48,255]},{position:[9,4,2],colour:[0,152,48,255]},{position:[9,4,3],colour:[252,152,0,255]},{position:[9,4,4],colour:[0,152,48,255]},{position:[9,5,2],colour:[0,152,48,255]},{position:[9,5,3],colour:[252,152,0,255]},{position:[9,5,4],colour:[0,152,48,255]},{position:[9,6,2],colour:[48,204,0,255]},{position:[9,6,3],colour:[252,152,0,255]},{position:[9,6,4],colour:[252,152,0,255]},{position:[9,6,5],colour:[252,152,0,255]},{position:[9,6,6],colour:[252,152,0,255]},{position:[9,7,2],colour:[252,152,100,255]},{position:[9,7,3],colour:[252,152,0,255]},{position:[9,7,4],colour:[252,152,0,255]},{position:[9,7,5],colour:[252,152,0,255]},{position:[9,8,2],colour:[252,204,152,255]},{position:[9,8,3],colour:[252,152,0,255]},{position:[9,8,4],colour:[252,152,0,255]},{position:[9,8,5],colour:[116,116,116,255]},{position:[9,9,1],colour:[252,152,0,255]},{position:[9,9,2],colour:[252,152,0,255]},{position:[9,9,3],colour:[252,152,0,255]},{position:[9,9,4],colour:[252,152,0,255]},{position:[9,9,5],colour:[252,152,0,255]},{position:[9,9,6],colour:[116,116,116,255]},{position:[9,9,7],colour:[116,116,116,255]},{position:[9,10,0],colour:[168,168,168,255]},{position:[9,10,1],colour:[252,152,0,255]},{position:[9,10,2],colour:[252,152,0,255]},{position:[9,10,3],colour:[252,152,0,255]},{position:[9,10,4],colour:[252,152,0,255]},{position:[9,10,5],colour:[252,152,0,255]},{position:[9,10,6],colour:[252,152,0,255]},{position:[9,10,7],colour:[116,116,116,255]},{position:[9,11,0],colour:[168,168,168,255]},{position:[9,11,1],colour:[252,152,0,255]},{position:[9,11,2],colour:[252,152,0,255]},{position:[9,11,3],colour:[252,152,0,255]},{position:[9,11,4],colour:[252,152,0,255]},{position:[9,11,5],colour:[252,152,0,255]},{position:[9,11,6],colour:[116,116,116,255]},{position:[9,12,1],colour:[136,136,136,255]},{position:[9,12,2],colour:[252,152,0,255]},{position:[9,12,3],colour:[252,152,0,255]},{position:[9,12,4],colour:[252,152,0,255]},{position:[9,12,5],colour:[116,116,116,255]},{position:[9,13,2],colour:[136,136,136,255]},{position:[9,13,3],colour:[136,136,136,255]},{position:[9,13,4],colour:[136,136,136,255]},{position:[10,3,1],colour:[48,204,48,255]},{position:[10,3,2],colour:[48,204,48,255]},{position:[10,3,3],colour:[48,204,48,255]},{position:[10,3,4],colour:[48,204,48,255]},{position:[10,3,5],colour:[48,204,48,255]},{position:[10,4,2],colour:[48,204,48,255]},{position:[10,4,3],colour:[252,152,0,255]},{position:[10,4,4],colour:[48,204,48,255]},{position:[10,5,2],colour:[48,204,48,255]},{position:[10,5,3],colour:[252,152,0,255]},{position:[10,5,4],colour:[48,204,48,255]},{position:[10,6,2],colour:[48,204,48,255]},{position:[10,6,3],colour:[252,152,0,255]},{position:[10,6,4],colour:[252,152,0,255]},{position:[10,6,5],colour:[252,152,0,255]},{position:[10,6,6],colour:[252,152,0,255]},{position:[10,7,2],colour:[252,204,152,255]},{position:[10,7,3],colour:[252,152,0,255]},{position:[10,7,4],colour:[252,152,0,255]},{position:[10,7,5],colour:[252,152,0,255]},{position:[10,8,2],colour:[252,204,152,255]},{position:[10,8,3],colour:[252,152,0,255]},{position:[10,8,4],colour:[252,152,0,255]},{position:[10,8,5],colour:[116,116,116,255]},{position:[10,9,2],colour:[252,152,0,255]},{position:[10,9,3],colour:[252,152,0,255]},{position:[10,9,4],colour:[252,152,0,255]},{position:[10,9,5],colour:[252,152,0,255]},{position:[10,9,6],colour:[116,116,116,255]},{position:[10,9,7],colour:[116,116,116,255]},{position:[10,10,0],colour:[184,184,184,255]},{position:[10,10,1],colour:[136,136,136,255]},{position:[10,10,2],colour:[252,152,0,255]},{position:[10,10,3],colour:[252,152,0,255]},{position:[10,10,4],colour:[252,152,0,255]},{position:[10,10,5],colour:[252,152,0,255]},{position:[10,10,6],colour:[252,152,0,255]},{position:[10,10,7],colour:[116,116,116,255]},{position:[10,11,0],colour:[184,184,184,255]},{position:[10,11,1],colour:[252,152,0,255]},{position:[10,11,2],colour:[252,152,0,255]},{position:[10,11,3],colour:[252,152,0,255]},{position:[10,11,4],colour:[252,152,0,255]},{position:[10,11,5],colour:[252,152,0,255]},{position:[10,11,6],colour:[116,116,116,255]},{position:[10,12,1],colour:[136,136,136,255]},{position:[10,12,2],colour:[252,152,0,255]},{position:[10,12,3],colour:[252,152,0,255]},{position:[10,12,4],colour:[252,152,0,255]},{position:[10,12,5],colour:[116,116,116,255]},{position:[10,13,2],colour:[136,136,136,255]},{position:[10,13,3],colour:[136,136,136,255]},{position:[10,13,4],colour:[136,136,136,255]},{position:[11,0,3],colour:[152,100,48,255]},{position:[11,1,3],colour:[152,100,48,255]},{position:[11,2,3],colour:[252,204,152,255]},{position:[11,3,1],colour:[0,152,48,255]},{position:[11,3,2],colour:[0,152,48,255]},{position:[11,3,3],colour:[252,152,0,255]},{position:[11,3,4],colour:[0,152,48,255]},{position:[11,3,5],colour:[0,152,48,255]},{position:[11,4,2],colour:[0,152,48,255]},{position:[11,4,3],colour:[48,204,48,255]},{position:[11,4,4],colour:[0,152,48,255]},{position:[11,5,2],colour:[48,204,48,255]},{position:[11,5,3],colour:[48,152,100,255]},{position:[11,5,4],colour:[48,152,100,255]},{position:[11,5,5],colour:[100,152,48,255]},{position:[11,5,6],colour:[252,152,0,255]},{position:[11,6,1],colour:[252,152,0,255]},{position:[11,6,2],colour:[252,152,0,255]},{position:[11,6,3],colour:[252,152,0,255]},{position:[11,6,4],colour:[252,152,0,255]},{position:[11,6,5],colour:[252,152,48,255]},{position:[11,7,2],colour:[252,204,152,255]},{position:[11,7,3],colour:[252,152,0,255]},{position:[11,7,4],colour:[252,152,0,255]},{position:[11,7,5],colour:[252,152,0,255]},{position:[11,7,6],colour:[252,152,0,255]},{position:[11,8,2],colour:[16,16,16,255]},{position:[11,8,3],colour:[252,152,0,255]},{position:[11,8,4],colour:[252,152,0,255]},{position:[11,8,5],colour:[252,152,0,255]},{position:[11,8,6],colour:[116,116,116,255]},{position:[11,8,7],colour:[116,116,116,255]},{position:[11,9,2],colour:[252,152,0,255]},{position:[11,9,3],colour:[252,152,0,255]},{position:[11,9,4],colour:[252,152,0,255]},{position:[11,9,5],colour:[252,152,0,255]},{position:[11,9,6],colour:[252,152,0,255]},{position:[11,9,7],colour:[116,116,116,255]},{position:[11,10,0],colour:[184,184,184,255]},{position:[11,10,1],colour:[136,136,136,255]},{position:[11,10,2],colour:[252,152,0,255]},{position:[11,10,3],colour:[252,152,0,255]},{position:[11,10,4],colour:[252,152,0,255]},{position:[11,10,5],colour:[252,152,0,255]},{position:[11,10,6],colour:[252,152,0,255]},{position:[11,10,7],colour:[116,116,116,255]},{position:[11,11,0],colour:[184,184,184,255]},{position:[11,11,1],colour:[252,152,0,255]},{position:[11,11,2],colour:[252,152,0,255]},{position:[11,11,3],colour:[252,152,0,255]},{position:[11,11,4],colour:[252,152,0,255]},{position:[11,11,5],colour:[252,152,0,255]},{position:[11,11,6],colour:[116,116,116,255]},{position:[11,12,1],colour:[136,136,136,255]},{position:[11,12,2],colour:[252,152,0,255]},{position:[11,12,3],colour:[252,152,0,255]},{position:[11,12,4],colour:[252,152,0,255]},{position:[11,12,5],colour:[116,116,116,255]},{position:[11,13,2],colour:[136,136,136,255]},{position:[11,13,3],colour:[136,136,136,255]},{position:[11,13,4],colour:[136,136,136,255]},{position:[12,3,1],colour:[48,204,48,255]},{position:[12,3,2],colour:[0,152,48,255]},{position:[12,3,3],colour:[48,204,48,255]},{position:[12,3,4],colour:[0,152,48,255]},{position:[12,3,5],colour:[48,204,48,255]},{position:[12,4,6],colour:[252,152,0,255]},{position:[12,5,2],colour:[252,152,0,255]},{position:[12,6,2],colour:[252,152,0,255]},{position:[12,6,3],colour:[0,152,48,255]},{position:[12,6,4],colour:[252,152,0,255]},{position:[12,6,5],colour:[252,152,0,255]},{position:[12,6,6],colour:[252,152,0,255]},{position:[12,7,1],colour:[252,152,0,255]},{position:[12,7,3],colour:[252,152,48,255]},{position:[12,7,4],colour:[252,152,0,255]},{position:[12,7,5],colour:[252,152,0,255]},{position:[12,8,1],colour:[252,152,0,255]},{position:[12,8,2],colour:[252,152,0,255]},{position:[12,8,3],colour:[252,152,0,255]},{position:[12,8,4],colour:[252,152,0,255]},{position:[12,8,5],colour:[136,136,136,255]},{position:[12,9,1],colour:[252,152,0,255]},{position:[12,9,2],colour:[204,152,48,255]},{position:[12,9,3],colour:[252,152,0,255]},{position:[12,9,4],colour:[252,152,0,255]},{position:[12,9,5],colour:[252,152,0,255]},{position:[12,9,6],colour:[116,116,116,255]},{position:[12,10,0],colour:[184,184,184,255]},{position:[12,10,1],colour:[252,152,0,255]},{position:[12,10,2],colour:[252,152,0,255]},{position:[12,10,3],colour:[136,136,136,255]},{position:[12,10,4],colour:[252,152,0,255]},{position:[12,10,5],colour:[252,152,0,255]},{position:[12,10,6],colour:[116,116,116,255]},{position:[12,11,0],colour:[236,236,236,255]},{position:[12,11,1],colour:[252,152,0,255]},{position:[12,11,2],colour:[136,136,136,255]},{position:[12,11,3],colour:[252,152,0,255]},{position:[12,11,4],colour:[136,136,136,255]},{position:[12,11,5],colour:[252,152,0,255]},{position:[12,11,6],colour:[116,116,116,255]},{position:[12,12,1],colour:[136,136,136,255]},{position:[12,12,2],colour:[136,136,136,255]},{position:[12,12,3],colour:[136,136,136,255]},{position:[12,12,4],colour:[116,116,116,255]},{position:[12,12,5],colour:[116,116,116,255]},{position:[13,3,3],colour:[252,204,152,255]},{position:[13,3,6],colour:[252,152,0,255]},{position:[13,5,3],colour:[252,204,152,255]},{position:[13,5,6],colour:[252,152,0,255]},{position:[13,7,4],colour:[252,152,0,255]},{position:[13,8,2],colour:[136,136,136,255]},{position:[13,8,3],colour:[136,136,136,255]},{position:[13,8,4],colour:[136,136,136,255]},{position:[13,9,1],colour:[136,136,136,255]},{position:[13,9,3],colour:[136,136,136,255]},{position:[13,9,5],colour:[136,136,136,255]},{position:[13,10,1],colour:[136,136,136,255]},{position:[13,10,2],colour:[136,136,136,255]},{position:[13,10,4],colour:[136,136,136,255]},{position:[13,10,5],colour:[136,136,136,255]},{position:[13,11,1],colour:[136,136,136,255]},{position:[13,11,3],colour:[136,136,136,255]},{position:[13,11,5],colour:[136,136,136,255]},{position:[13,12,2],colour:[136,136,136,255]},{position:[13,12,3],colour:[136,136,136,255]},{position:[13,12,4],colour:[136,136,136,255]},{position:[13,13,3],colour:[136,136,136,255]},{position:[14,4,3],colour:[252,204,152,255]},{position:[14,4,6],colour:[252,152,0,255]},{position:[14,6,5],colour:[252,152,0,255]},{position:[14,13,3],colour:[136,136,136,255]},{position:[14,14,3],colour:[168,168,168,255]},{position:[15,3,6],colour:[252,152,0,255]},{position:[16,4,5],colour:[252,152,0,255]},{position:[16,6,3],colour:[252,152,0,255]},{position:[17,5,4],colour:[252,152,0,255]}],sliceFilePaths:["https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/0.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/1.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/2.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/3.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/4.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/5.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/6.png","https://dj24.github.io/soulflame-webgpu/voxel-models/mini-viking/7.png"],emissiveVoxels:[]}}},e={};function r(o){var n=e[o];if(void 0!==n)return n.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,r),i.exports}r.m=t,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.u=t=>t+".main.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&!t;)t=o[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),r.b=document.baseURI||self.location.href;var o={};(()=>{"use strict";r.d(o,{nS:()=>dn,JQ:()=>sn,f1:()=>rn,sL:()=>hn,Uh:()=>on,Pp:()=>nn,ZU:()=>an});const t=(t,e)=>{const r=new Uint32Array(e);on.queue.writeBuffer(t,0,r.buffer,0,e.length*Uint32Array.BYTES_PER_ELEMENT)},e=(e,r)=>{const o=new Uint32Array(e),n=on.createBuffer({size:o.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:r});return t(n,e),n},n=(t,e)=>{if(e instanceof Float32Array)on.queue.writeBuffer(t,0,e.buffer,0,e.length*Float32Array.BYTES_PER_ELEMENT);else{const r=new Float32Array(e);on.queue.writeBuffer(t,0,r.buffer,0,e.length*Float32Array.BYTES_PER_ELEMENT)}},i=(t,e,r)=>{const o=new Float32Array(e),i=t.createBuffer({size:o.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:r});return n(i,e),i},s="struct BoxIntersectionResult {\r\n    tNear: f32,\r\n    tFar: f32,\r\n    normal: vec3<f32>,\r\n}\r\n\r\nfn boxIntersection(\r\n    ro: vec3<f32>,\r\n    rd: vec3<f32>,\r\n    boxSize: vec3<f32>,\r\n) -> BoxIntersectionResult {\r\n    var result = BoxIntersectionResult();\r\n    let offsetRayOrigin = ro - boxSize;\r\n    let m: vec3<f32> = 1.0 / rd;\r\n    let n: vec3<f32> = m * offsetRayOrigin;\r\n    let k: vec3<f32> = abs(m) * boxSize;\r\n    let t1: vec3<f32> = -n - k;\r\n    let t2: vec3<f32> = -n + k;\r\n    let tN: f32 = max(max(t1.x, t1.y), t1.z);\r\n    let tF: f32 = min(min(t2.x, t2.y), t2.z);\r\n    if (tN > tF || tF < 0.0) {\r\n        result.tNear = -1.0;\r\n        result.tFar = -1.0;\r\n        result.normal = vec3(0.0);\r\n        return result;\r\n    }\r\n    // Check if the ray starts inside the volume\r\n    let insideVolume = tN < 0.0;\r\n    var normal = select(\r\n        step(vec3<f32>(tN), t1),\r\n        step(t2, vec3<f32>(tF)),\r\n        tN < 0.0,\r\n    );\r\n    normal *= -sign(rd);\r\n    // Check if the intersection is in the correct direction, only if inside the volume\r\n    if (insideVolume && dot(normal, rd) < 0.0) {\r\n        result.tNear = -1.0;\r\n        result.tFar = -1.0;\r\n        result.normal = vec3(0.0);\r\n        return result;\r\n    }\r\n    result.tNear = tN;\r\n    result.tFar = tF;\r\n    result.normal = normal;\r\n    return result;\r\n}",a="const EPSILON = 0.0001;\r\nconst MAX_RAY_STEPS = 512;\r\n\r\n// Function to transform a normal vector from object to world space\r\nfn transformNormal(inverseTransform: mat4x4<f32>, normal: vec3<f32>) -> vec3<f32> {\r\n    let worldNormal = normalize((vec4<f32>(normal, 0.0) * inverseTransform).xyz);\r\n    return worldNormal;\r\n}\r\n\r\n// Function to transform an object space position to world space\r\nfn transformPosition(transform: mat4x4<f32>, position: vec3<f32>) -> vec3<f32> {\r\n    let worldPosition = (transform * vec4<f32>(position, 1.0)).xyz;\r\n    return worldPosition;\r\n}\r\n\r\nstruct VoxelObject {\r\n  transform: mat4x4<f32>,\r\n  inverseTransform: mat4x4<f32>,\r\n  size : vec3<f32>,\r\n  sizePadding : f32,\r\n  atlasLocation : vec3<f32>,\r\n  atlasLocationPadding : f32,\r\n}\r\n\r\nstruct RayMarchResult {\r\n  colour: vec3<f32>,\r\n  normal: vec3<f32>,\r\n  worldPos: vec3<f32>,\r\n  hit: bool,\r\n}\r\n\r\nfn rayMarch(startingObjectIndex: i32, rayOrigin: vec3<f32>, rayDirection: vec3<f32>, voxelObjects: array<VoxelObject, VOXEL_OBJECT_COUNT>, voxelsSampler: sampler) -> RayMarchResult {\r\n  var output = RayMarchResult();\r\n  output.hit = false;\r\n  output.colour = vec3(0.0);\r\n  output.normal = vec3(0.0);\r\n  output.worldPos = vec3(0.0);\r\n\r\n  var voxelSize = 1.0;\r\n  var tNear = 999999.0;\r\n  var closestIntersection = 9999999.0;\r\n  var stepsTaken = 0;\r\n  var objectsTraversed = 0;\r\n\r\n  for (var voxelObjectIndex = startingObjectIndex; voxelObjectIndex < VOXEL_OBJECT_COUNT; voxelObjectIndex++) {\r\n    var voxelObject = voxelObjects[voxelObjectIndex];\r\n    objectsTraversed ++;\r\n\r\n    // Empty object, go to next\r\n    if(voxelObject.size.x == 0.0){\r\n      continue;\r\n    }\r\n\r\n    var objectRayOrigin = (voxelObject.inverseTransform * vec4<f32>(rayOrigin, 1.0)).xyz;\r\n    let objectRayDirection = (voxelObject.inverseTransform * vec4<f32>(rayDirection, 0.0)).xyz;\r\n\r\n    let intersect = boxIntersection(objectRayOrigin, objectRayDirection, voxelObject.size * 0.5);\r\n    tNear = intersect.tNear + EPSILON;\r\n\r\n    // bounding box is further away than the closest intersection, so we can skip this object\r\n    let isInsideAlreadyMarchedVoxel = tNear > closestIntersection;\r\n    if(isInsideAlreadyMarchedVoxel){\r\n        continue;\r\n    }\r\n\r\n    let boundingBoxSurfacePosition = objectRayOrigin + tNear * objectRayDirection;\r\n    let isStartingInBounds = all(objectRayOrigin >= vec3(-1.0)) && all(objectRayOrigin < vec3(voxelObject.size / voxelSize));\r\n    let isBackwardsIntersection = tNear < EPSILON && !isStartingInBounds;\r\n    if(isBackwardsIntersection){\r\n      continue;\r\n    }\r\n\r\n    var tIntersection = tNear;\r\n    var objectPos = boundingBoxSurfacePosition;\r\n    var voxelStep = sign(objectRayDirection);\r\n    var tDelta = vec3(voxelSize / abs(objectRayDirection));\r\n    let scaledRayOrigin = vec3<f32>(objectRayOrigin) / voxelSize;\r\n    var currentIndex = floor(objectPos / voxelSize);\r\n    var voxelOriginDifference = currentIndex - scaledRayOrigin;\r\n    var clampedVoxelBoundary = (voxelStep * 0.5) + 0.5; // 0 if <= 0, 1 if > 0\r\n    var tMax = (voxelStep * voxelOriginDifference + clampedVoxelBoundary) * tDelta;\r\n    let maxSteps = max(voxelObject.size.x,voxelObject.size.y) * 2;\r\n    var objectStepsTaken = 0;\r\n    let mask = vec3(\r\n        select(0.0, 1.0, tMax.x == tIntersection),\r\n        select(0.0, 1.0, tMax.y == tIntersection),\r\n        select(0.0, 1.0, tMax.z == tIntersection)\r\n    );\r\n    var objectNormal = intersect.normal;\r\n\r\n    while(objectStepsTaken <= i32(maxSteps) && stepsTaken < MAX_RAY_STEPS)\r\n    {\r\n      stepsTaken ++;\r\n      objectStepsTaken ++;\r\n\r\n      let isInBounds = all(currentIndex >= vec3(0.0)) && all(currentIndex <= vec3(voxelObject.size / voxelSize));\r\n      if(!isInBounds){\r\n          break;\r\n      }\r\n      let isInsideAlreadyMarchedVoxel = tIntersection > closestIntersection;\r\n      if(isInsideAlreadyMarchedVoxel){\r\n          break;\r\n      }\r\n      let foo = textureLoad(voxels, vec3<u32>(currentIndex) + vec3<u32>(voxelObject.atlasLocation), 0);\r\n      if(foo.a > 0.0&& tIntersection > EPSILON){\r\n          closestIntersection = tIntersection;\r\n          output.worldPos = transformPosition(voxelObject.transform, objectPos);\r\n          output.normal = transformNormal(voxelObject.inverseTransform,objectNormal);\r\n          output.colour = foo.rgb;\r\n          output.hit = true;\r\n          break; // Found hit in this object, continue to next\r\n      }\r\n\r\n      // Iterate to next voxel\r\n      let mask = vec3(\r\n          select(0.0, 1.0, tMax.x == tIntersection),\r\n          select(0.0, 1.0, tMax.y == tIntersection),\r\n          select(0.0, 1.0, tMax.z == tIntersection)\r\n      );\r\n      tMax += mask * tDelta;\r\n      currentIndex += mask * voxelStep;\r\n      objectNormal = vec3(mask * -voxelStep);\r\n      objectPos = objectRayOrigin + objectRayDirection * tIntersection;\r\n      tIntersection = min(min(tMax.x, tMax.y), tMax.z);\r\n    }\r\n  }\r\n  return output;\r\n}",u="struct FrustumCornerDirections {\r\n  topLeft : vec3<f32>,\r\n  topRight : vec3<f32>,\r\n  bottomLeft : vec3<f32>,\r\n  bottomRight : vec3<f32>\r\n}\r\n\r\nfn calculateRayDirection(uv: vec2<f32>, directions: FrustumCornerDirections) -> vec3<f32> {\r\n  let topInterpolated = mix(directions.topLeft, directions.topRight, uv.x);\r\n  let bottomInterpolated = mix(directions.bottomLeft, directions.bottomRight, uv.x);\r\n  let finalInterpolated = mix(bottomInterpolated, topInterpolated, uv.y);\r\n  return normalize(finalInterpolated);\r\n}\r\n",c=async()=>{const t=on.createComputePipeline({layout:"auto",compute:{module:on.createShaderModule({code:`\n          const VOXEL_OBJECT_COUNT = ${rn.objectCount};\n          ${u}\n          ${s}\n          ${a}\n          @group(1) @binding(0) var voxelsSampler : sampler;\r\n@group(1) @binding(1) var voxels : texture_3d<f32>;\r\n@group(0) @binding(2) var<uniform> resolution : vec2<u32>;\r\n@group(0) @binding(3) var<uniform> frustumCornerDirections : FrustumCornerDirections;\r\n@group(0) @binding(4) var<uniform> cameraPosition : vec3<f32>;\r\n@group(0) @binding(5) var<uniform> voxelObjects : array<VoxelObject, VOXEL_OBJECT_COUNT>; // TODO: dynamic amount of these using string interpolation\r\n// TODO: maybe make a G-Buffer bind group to resuse across shaders\r\n@group(0) @binding(6) var normalTex : texture_storage_2d<rgba8snorm, write>;\r\n@group(0) @binding(7) var albedoTex : texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(8) var depthTex : texture_storage_2d<r32float, write>;\r\n@group(0) @binding(9) var skyTex : texture_cube<f32>;\r\n\r\nfn plainIntersect(ro: vec3<f32>, rd: vec3<f32>, p: vec4<f32>) -> f32 {\r\n    return -(dot(ro, p.xyz) + p.w) / dot(rd, p.xyz);\r\n}\r\n\r\nconst FAR_PLANE = 10000.0;\r\n\r\n@compute @workgroup_size(8, 8, 1)\r\nfn main(\r\n  @builtin(global_invocation_id) GlobalInvocationID : vec3<u32>\r\n) {\r\n  var uv = vec2<f32>(GlobalInvocationID.xy) / vec2<f32>(resolution);\r\n  uv = vec2(uv.x, 1.0 - uv.y);\r\n  var pixel = uv * vec2<f32>(resolution);\r\n  var rayDirection = calculateRayDirection(uv,frustumCornerDirections);\r\n  var rayOrigin = cameraPosition;\r\n\r\n  var sky = textureSampleLevel(skyTex, voxelsSampler, rayDirection, 0.0).rgb;\r\n\r\n  let rayMarchResult = rayMarch(0, rayOrigin, rayDirection, voxelObjects, voxelsSampler);\r\n\r\n  var colour = rayMarchResult.colour;\r\n//  colour = abs(rayMarchResult.worldPos) %1;\r\n  if(all(rayMarchResult.colour == vec3<f32>(0.0))){\r\n    colour = sky;\r\n  }\r\n\r\n  textureStore(normalTex, GlobalInvocationID.xy, vec4(rayMarchResult.normal,1));\r\n  textureStore(albedoTex, GlobalInvocationID.xy, vec4(colour,1));\r\n\r\n  let depth = distance(rayMarchResult.worldPos, cameraPosition);\r\n  textureStore(depthTex, GlobalInvocationID.xy, vec4(depth,0.0,0.0,0.0));\r\n}\r\n`}),entryPoint:"main"}});return{render:({commandEncoder:e,resolutionBuffer:r,outputTextureViews:o,cameraPositionBuffer:n,frustumCornerDirectionsBuffer:i,voxelTextureView:s,transformationMatrixBuffer:a})=>{const u=e.beginComputePass();u.setPipeline(t);const c=on.createSampler({magFilter:"nearest",minFilter:"nearest"}),l=on.createBindGroup({layout:t.getBindGroupLayout(0),entries:[{binding:2,resource:{buffer:r}},{binding:3,resource:{buffer:i}},{binding:4,resource:{buffer:n}},{binding:5,resource:{buffer:a}},{binding:6,resource:o.normalTextureView},{binding:7,resource:o.albedoTextureView},{binding:8,resource:o.depthAndClusterTextureView},{binding:9,resource:o.skyTextureView}]}),p=on.createBindGroup({layout:t.getBindGroupLayout(1),entries:[{binding:0,resource:c},{binding:1,resource:s}]});u.setBindGroup(0,l),u.setBindGroup(1,p),u.dispatchWorkgroups(Math.ceil(an[0]/8),Math.ceil(an[1]/8)),u.end()}}};let l=1e-6,p=Float32Array;function h(t=0,e=0){const r=new p(2);return void 0!==t&&(r[0]=t,void 0!==e&&(r[1]=e)),r}let d=Float32Array;function m(t,e,r){const o=new d(3);return void 0!==t&&(o[0]=t,void 0!==e&&(o[1]=e,void 0!==r&&(o[2]=r))),o}const f=h;function _(t,e,r){return(r=r||new p(2))[0]=t[0]-e[0],r[1]=t[1]-e[1],r}const g=_;function y(t,e,r){return(r=r||new p(2))[0]=t[0]*e,r[1]=t[1]*e,r}const w=y;function x(t,e){return(e=e||new p(2))[0]=1/t[0],e[1]=1/t[1],e}const v=x;function b(t,e){return t[0]*e[0]+t[1]*e[1]}function k(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}const T=k;function M(t){const e=t[0],r=t[1];return e*e+r*r}const S=M;function E(t,e){const r=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(r*r+o*o)}const A=E;function I(t,e){const r=t[0]-e[0],o=t[1]-e[1];return r*r+o*o}const P=I;function O(t,e){return(e=e||new p(2))[0]=t[0],e[1]=t[1],e}const U=O;function z(t,e,r){return(r=r||new p(2))[0]=t[0]*e[0],r[1]=t[1]*e[1],r}const N=z;function V(t,e,r){return(r=r||new p(2))[0]=t[0]/e[0],r[1]=t[1]/e[1],r}const D=V;var q=Object.freeze({__proto__:null,create:h,setDefaultType:function(t){const e=p;return p=t,e},fromValues:f,set:function(t,e,r){return(r=r||new p(2))[0]=t,r[1]=e,r},ceil:function(t,e){return(e=e||new p(2))[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(t,e){return(e=e||new p(2))[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},round:function(t,e){return(e=e||new p(2))[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},clamp:function(t,e=0,r=1,o){return(o=o||new p(2))[0]=Math.min(r,Math.max(e,t[0])),o[1]=Math.min(r,Math.max(e,t[1])),o},add:function(t,e,r){return(r=r||new p(2))[0]=t[0]+e[0],r[1]=t[1]+e[1],r},addScaled:function(t,e,r,o){return(o=o||new p(2))[0]=t[0]+e[0]*r,o[1]=t[1]+e[1]*r,o},angle:function(t,e){const r=t[0],o=t[1],n=t[0],i=t[1],s=Math.sqrt(r*r+o*o)*Math.sqrt(n*n+i*i),a=s&&b(t,e)/s;return Math.acos(a)},subtract:_,sub:g,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<l&&Math.abs(t[1]-e[1])<l},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},lerp:function(t,e,r,o){return(o=o||new p(2))[0]=t[0]+r*(e[0]-t[0]),o[1]=t[1]+r*(e[1]-t[1]),o},lerpV:function(t,e,r,o){return(o=o||new p(2))[0]=t[0]+r[0]*(e[0]-t[0]),o[1]=t[1]+r[1]*(e[1]-t[1]),o},max:function(t,e,r){return(r=r||new p(2))[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r},min:function(t,e,r){return(r=r||new p(2))[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r},mulScalar:y,scale:w,divScalar:function(t,e,r){return(r=r||new p(2))[0]=t[0]/e,r[1]=t[1]/e,r},inverse:x,invert:v,cross:function(t,e,r){r=r||new d(3);const o=t[0]*e[1]-t[1]*e[0];return r[0]=0,r[1]=0,r[2]=o,r},dot:b,length:k,len:T,lengthSq:M,lenSq:S,distance:E,dist:A,distanceSq:I,distSq:P,normalize:function(t,e){e=e||new p(2);const r=t[0],o=t[1],n=Math.sqrt(r*r+o*o);return n>1e-5?(e[0]=r/n,e[1]=o/n):(e[0]=0,e[1]=0),e},negate:function(t,e){return(e=e||new p(2))[0]=-t[0],e[1]=-t[1],e},copy:O,clone:U,multiply:z,mul:N,divide:V,div:D,random:function(t=1,e){e=e||new p(2);const r=2*Math.random()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},zero:function(t){return(t=t||new p(2))[0]=0,t[1]=0,t},transformMat4:function(t,e,r){r=r||new p(2);const o=t[0],n=t[1];return r[0]=o*e[0]+n*e[4]+e[12],r[1]=o*e[1]+n*e[5]+e[13],r},transformMat3:function(t,e,r){r=r||new p(2);const o=t[0],n=t[1];return r[0]=e[0]*o+e[4]*n+e[8],r[1]=e[1]*o+e[5]*n+e[9],r}});Float32Array;new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]).get(Float32Array);const R=m;function G(t,e,r){return(r=r||new d(3))[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}const C=G;function j(t,e,r){return(r=r||new d(3))[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}const L=j;function F(t,e){return(e=e||new d(3))[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}const B=F;function $(t,e,r){r=r||new d(3);const o=t[2]*e[0]-t[0]*e[2],n=t[0]*e[1]-t[1]*e[0];return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=o,r[2]=n,r}function X(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Y(t){const e=t[0],r=t[1],o=t[2];return Math.sqrt(e*e+r*r+o*o)}const H=Y;function W(t){const e=t[0],r=t[1],o=t[2];return e*e+r*r+o*o}const Q=W;function Z(t,e){const r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+o*o+n*n)}const J=Z;function K(t,e){const r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2];return r*r+o*o+n*n}const tt=K;function et(t,e){e=e||new d(3);const r=t[0],o=t[1],n=t[2],i=Math.sqrt(r*r+o*o+n*n);return i>1e-5?(e[0]=r/i,e[1]=o/i,e[2]=n/i):(e[0]=0,e[1]=0,e[2]=0),e}function rt(t,e){return(e=e||new d(3))[0]=t[0],e[1]=t[1],e[2]=t[2],e}const ot=rt;function nt(t,e,r){return(r=r||new d(3))[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}const it=nt;function st(t,e,r){return(r=r||new d(3))[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}const at=st;var ut=Object.freeze({__proto__:null,create:m,setDefaultType:function(t){const e=d;return d=t,e},fromValues:R,set:function(t,e,r,o){return(o=o||new d(3))[0]=t,o[1]=e,o[2]=r,o},ceil:function(t,e){return(e=e||new d(3))[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(t,e){return(e=e||new d(3))[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},round:function(t,e){return(e=e||new d(3))[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},clamp:function(t,e=0,r=1,o){return(o=o||new d(3))[0]=Math.min(r,Math.max(e,t[0])),o[1]=Math.min(r,Math.max(e,t[1])),o[2]=Math.min(r,Math.max(e,t[2])),o},add:function(t,e,r){return(r=r||new d(3))[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r},addScaled:function(t,e,r,o){return(o=o||new d(3))[0]=t[0]+e[0]*r,o[1]=t[1]+e[1]*r,o[2]=t[2]+e[2]*r,o},angle:function(t,e){const r=t[0],o=t[1],n=t[2],i=t[0],s=t[1],a=t[2],u=Math.sqrt(r*r+o*o+n*n)*Math.sqrt(i*i+s*s+a*a),c=u&&X(t,e)/u;return Math.acos(c)},subtract:G,sub:C,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<l&&Math.abs(t[1]-e[1])<l&&Math.abs(t[2]-e[2])<l},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},lerp:function(t,e,r,o){return(o=o||new d(3))[0]=t[0]+r*(e[0]-t[0]),o[1]=t[1]+r*(e[1]-t[1]),o[2]=t[2]+r*(e[2]-t[2]),o},lerpV:function(t,e,r,o){return(o=o||new d(3))[0]=t[0]+r[0]*(e[0]-t[0]),o[1]=t[1]+r[1]*(e[1]-t[1]),o[2]=t[2]+r[2]*(e[2]-t[2]),o},max:function(t,e,r){return(r=r||new d(3))[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r},min:function(t,e,r){return(r=r||new d(3))[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r},mulScalar:j,scale:L,divScalar:function(t,e,r){return(r=r||new d(3))[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r},inverse:F,invert:B,cross:$,dot:X,length:Y,len:H,lengthSq:W,lenSq:Q,distance:Z,dist:J,distanceSq:K,distSq:tt,normalize:et,negate:function(t,e){return(e=e||new d(3))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},copy:rt,clone:ot,multiply:nt,mul:it,divide:st,div:at,random:function(t=1,e){e=e||new d(3);const r=2*Math.random()*Math.PI,o=2*Math.random()-1,n=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=o*t,e},zero:function(t){return(t=t||new d(3))[0]=0,t[1]=0,t[2]=0,t},transformMat4:function(t,e,r){r=r||new d(3);const o=t[0],n=t[1],i=t[2],s=e[3]*o+e[7]*n+e[11]*i+e[15]||1;return r[0]=(e[0]*o+e[4]*n+e[8]*i+e[12])/s,r[1]=(e[1]*o+e[5]*n+e[9]*i+e[13])/s,r[2]=(e[2]*o+e[6]*n+e[10]*i+e[14])/s,r},transformMat4Upper3x3:function(t,e,r){r=r||new d(3);const o=t[0],n=t[1],i=t[2];return r[0]=o*e[0]+n*e[4]+i*e[8],r[1]=o*e[1]+n*e[5]+i*e[9],r[2]=o*e[2]+n*e[6]+i*e[10],r},transformMat3:function(t,e,r){r=r||new d(3);const o=t[0],n=t[1],i=t[2];return r[0]=o*e[0]+n*e[4]+i*e[8],r[1]=o*e[1]+n*e[5]+i*e[9],r[2]=o*e[2]+n*e[6]+i*e[10],r},transformQuat:function(t,e,r){r=r||new d(3);const o=e[0],n=e[1],i=e[2],s=2*e[3],a=t[0],u=t[1],c=t[2],l=n*c-i*u,p=i*a-o*c,h=o*u-n*a;return r[0]=a+l*s+2*(n*h-i*p),r[1]=u+p*s+2*(i*l-o*h),r[2]=c+h*s+2*(o*p-n*l),r},getTranslation:function(t,e){return(e=e||new d(3))[0]=t[12],e[1]=t[13],e[2]=t[14],e},getAxis:function(t,e,r){const o=4*e;return(r=r||new d(3))[0]=t[o+0],r[1]=t[o+1],r[2]=t[o+2],r},getScaling:function(t,e){e=e||new d(3);const r=t[0],o=t[1],n=t[2],i=t[4],s=t[5],a=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+o*o+n*n),e[1]=Math.sqrt(i*i+s*s+a*a),e[2]=Math.sqrt(u*u+c*c+l*l),e}});let ct=Float32Array;function lt(t,e){return(e=e||new ct(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}const pt=lt;function ht(t){return(t=t||new ct(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dt(t,e){e=e||new ct(16);const r=t[0],o=t[1],n=t[2],i=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],p=t[9],h=t[10],d=t[11],m=t[12],f=t[13],_=t[14],g=t[15],y=h*g,w=_*d,x=u*g,v=_*c,b=u*d,k=h*c,T=n*g,M=_*i,S=n*d,E=h*i,A=n*c,I=u*i,P=l*f,O=m*p,U=s*f,z=m*a,N=s*p,V=l*a,D=r*f,q=m*o,R=r*p,G=l*o,C=r*a,j=s*o,L=y*a+v*p+b*f-(w*a+x*p+k*f),F=w*o+T*p+E*f-(y*o+M*p+S*f),B=x*o+M*a+A*f-(v*o+T*a+I*f),$=k*o+S*a+I*p-(b*o+E*a+A*p),X=1/(r*L+s*F+l*B+m*$);return e[0]=X*L,e[1]=X*F,e[2]=X*B,e[3]=X*$,e[4]=X*(w*s+x*l+k*m-(y*s+v*l+b*m)),e[5]=X*(y*r+M*l+S*m-(w*r+T*l+E*m)),e[6]=X*(v*r+T*s+I*m-(x*r+M*s+A*m)),e[7]=X*(b*r+E*s+A*l-(k*r+S*s+I*l)),e[8]=X*(P*c+z*d+N*g-(O*c+U*d+V*g)),e[9]=X*(O*i+D*d+G*g-(P*i+q*d+R*g)),e[10]=X*(U*i+q*c+C*g-(z*i+D*c+j*g)),e[11]=X*(V*i+R*c+j*d-(N*i+G*c+C*d)),e[12]=X*(U*h+V*_+O*u-(N*_+P*u+z*h)),e[13]=X*(R*_+P*n+q*h-(D*h+G*_+O*n)),e[14]=X*(D*u+j*_+z*n-(C*_+U*n+q*u)),e[15]=X*(C*h+N*n+G*u-(R*u+j*h+V*n)),e}const mt=dt;function ft(t,e,r){r=r||new ct(16);const o=t[0],n=t[1],i=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],p=t[8],h=t[9],d=t[10],m=t[11],f=t[12],_=t[13],g=t[14],y=t[15],w=e[0],x=e[1],v=e[2],b=e[3],k=e[4],T=e[5],M=e[6],S=e[7],E=e[8],A=e[9],I=e[10],P=e[11],O=e[12],U=e[13],z=e[14],N=e[15];return r[0]=o*w+a*x+p*v+f*b,r[1]=n*w+u*x+h*v+_*b,r[2]=i*w+c*x+d*v+g*b,r[3]=s*w+l*x+m*v+y*b,r[4]=o*k+a*T+p*M+f*S,r[5]=n*k+u*T+h*M+_*S,r[6]=i*k+c*T+d*M+g*S,r[7]=s*k+l*T+m*M+y*S,r[8]=o*E+a*A+p*I+f*P,r[9]=n*E+u*A+h*I+_*P,r[10]=i*E+c*A+d*I+g*P,r[11]=s*E+l*A+m*I+y*P,r[12]=o*O+a*U+p*z+f*N,r[13]=n*O+u*U+h*z+_*N,r[14]=i*O+c*U+d*z+g*N,r[15]=s*O+l*U+m*z+y*N,r}const _t=ft;let gt,yt,wt;function xt(t,e,r){r=r||new ct(16);let o=t[0],n=t[1],i=t[2];const s=Math.sqrt(o*o+n*n+i*i);o/=s,n/=s,i/=s;const a=o*o,u=n*n,c=i*i,l=Math.cos(e),p=Math.sin(e),h=1-l;return r[0]=a+(1-a)*l,r[1]=o*n*h+i*p,r[2]=o*i*h-n*p,r[3]=0,r[4]=o*n*h-i*p,r[5]=u+(1-u)*l,r[6]=n*i*h+o*p,r[7]=0,r[8]=o*i*h+n*p,r[9]=n*i*h-o*p,r[10]=c+(1-c)*l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}const vt=xt;function bt(t,e,r,o){o=o||new ct(16);let n=e[0],i=e[1],s=e[2];const a=Math.sqrt(n*n+i*i+s*s);n/=a,i/=a,s/=a;const u=n*n,c=i*i,l=s*s,p=Math.cos(r),h=Math.sin(r),d=1-p,m=u+(1-u)*p,f=n*i*d+s*h,_=n*s*d-i*h,g=n*i*d-s*h,y=c+(1-c)*p,w=i*s*d+n*h,x=n*s*d+i*h,v=i*s*d-n*h,b=l+(1-l)*p,k=t[0],T=t[1],M=t[2],S=t[3],E=t[4],A=t[5],I=t[6],P=t[7],O=t[8],U=t[9],z=t[10],N=t[11];return o[0]=m*k+f*E+_*O,o[1]=m*T+f*A+_*U,o[2]=m*M+f*I+_*z,o[3]=m*S+f*P+_*N,o[4]=g*k+y*E+w*O,o[5]=g*T+y*A+w*U,o[6]=g*M+y*I+w*z,o[7]=g*S+y*P+w*N,o[8]=x*k+v*E+b*O,o[9]=x*T+v*A+b*U,o[10]=x*M+v*I+b*z,o[11]=x*S+v*P+b*N,t!==o&&(o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o}const kt=bt;var Tt=Object.freeze({__proto__:null,setDefaultType:function(t){const e=ct;return ct=t,e},create:function(t,e,r,o,n,i,s,a,u,c,l,p,h,d,m,f){const _=new ct(16);return void 0!==t&&(_[0]=t,void 0!==e&&(_[1]=e,void 0!==r&&(_[2]=r,void 0!==o&&(_[3]=o,void 0!==n&&(_[4]=n,void 0!==i&&(_[5]=i,void 0!==s&&(_[6]=s,void 0!==a&&(_[7]=a,void 0!==u&&(_[8]=u,void 0!==c&&(_[9]=c,void 0!==l&&(_[10]=l,void 0!==p&&(_[11]=p,void 0!==h&&(_[12]=h,void 0!==d&&(_[13]=d,void 0!==m&&(_[14]=m,void 0!==f&&(_[15]=f)))))))))))))))),_},set:function(t,e,r,o,n,i,s,a,u,c,l,p,h,d,m,f,_){return(_=_||new ct(16))[0]=t,_[1]=e,_[2]=r,_[3]=o,_[4]=n,_[5]=i,_[6]=s,_[7]=a,_[8]=u,_[9]=c,_[10]=l,_[11]=p,_[12]=h,_[13]=d,_[14]=m,_[15]=f,_},fromMat3:function(t,e){return(e=e||new ct(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=0,e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromQuat:function(t,e){e=e||new ct(16);const r=t[0],o=t[1],n=t[2],i=t[3],s=r+r,a=o+o,u=n+n,c=r*s,l=o*s,p=o*a,h=n*s,d=n*a,m=n*u,f=i*s,_=i*a,g=i*u;return e[0]=1-p-m,e[1]=l+g,e[2]=h-_,e[3]=0,e[4]=l-g,e[5]=1-c-m,e[6]=d+f,e[7]=0,e[8]=h+_,e[9]=d-f,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},negate:function(t,e){return(e=e||new ct(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},copy:lt,clone:pt,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<l&&Math.abs(t[1]-e[1])<l&&Math.abs(t[2]-e[2])<l&&Math.abs(t[3]-e[3])<l&&Math.abs(t[4]-e[4])<l&&Math.abs(t[5]-e[5])<l&&Math.abs(t[6]-e[6])<l&&Math.abs(t[7]-e[7])<l&&Math.abs(t[8]-e[8])<l&&Math.abs(t[9]-e[9])<l&&Math.abs(t[10]-e[10])<l&&Math.abs(t[11]-e[11])<l&&Math.abs(t[12]-e[12])<l&&Math.abs(t[13]-e[13])<l&&Math.abs(t[14]-e[14])<l&&Math.abs(t[15]-e[15])<l},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},identity:ht,transpose:function(t,e){if((e=e||new ct(16))===t){let r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[3],t[3]=t[12],t[12]=r,r=t[6],t[6]=t[9],t[9]=r,r=t[7],t[7]=t[13],t[13]=r,r=t[11],t[11]=t[14],t[14]=r,e}const r=t[0],o=t[1],n=t[2],i=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],p=t[9],h=t[10],d=t[11],m=t[12],f=t[13],_=t[14],g=t[15];return e[0]=r,e[1]=s,e[2]=l,e[3]=m,e[4]=o,e[5]=a,e[6]=p,e[7]=f,e[8]=n,e[9]=u,e[10]=h,e[11]=_,e[12]=i,e[13]=c,e[14]=d,e[15]=g,e},inverse:dt,determinant:function(t){const e=t[0],r=t[1],o=t[2],n=t[3],i=t[4],s=t[5],a=t[6],u=t[7],c=t[8],l=t[9],p=t[10],h=t[11],d=t[12],m=t[13],f=t[14],_=t[15],g=p*_,y=f*h,w=a*_,x=f*u,v=a*h,b=p*u,k=o*_,T=f*n,M=o*h,S=p*n,E=o*u,A=a*n;return e*(g*s+x*l+v*m-(y*s+w*l+b*m))+i*(y*r+k*l+S*m-(g*r+T*l+M*m))+c*(w*r+T*s+E*m-(x*r+k*s+A*m))+d*(b*r+M*s+A*l-(v*r+S*s+E*l))},invert:mt,multiply:ft,mul:_t,setTranslation:function(t,e,r){return t!==(r=r||ht())&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},getTranslation:function(t,e){return(e=e||m())[0]=t[12],e[1]=t[13],e[2]=t[14],e},getAxis:function(t,e,r){const o=4*e;return(r=r||m())[0]=t[o+0],r[1]=t[o+1],r[2]=t[o+2],r},setAxis:function(t,e,r,o){o!==t&&(o=lt(t,o));const n=4*r;return o[n+0]=e[0],o[n+1]=e[1],o[n+2]=e[2],o},getScaling:function(t,e){e=e||m();const r=t[0],o=t[1],n=t[2],i=t[4],s=t[5],a=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+o*o+n*n),e[1]=Math.sqrt(i*i+s*s+a*a),e[2]=Math.sqrt(u*u+c*c+l*l),e},perspective:function(t,e,r,o,n){n=n||new ct(16);const i=Math.tan(.5*Math.PI-.5*t);if(n[0]=i/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o===1/0)n[10]=-1,n[14]=-r;else{const t=1/(r-o);n[10]=o*t,n[14]=o*r*t}return n},ortho:function(t,e,r,o,n,i,s){return(s=s||new ct(16))[0]=2/(e-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(o-r),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(n-i),s[11]=0,s[12]=(e+t)/(t-e),s[13]=(o+r)/(r-o),s[14]=n/(n-i),s[15]=1,s},frustum:function(t,e,r,o,n,i,s){const a=e-t,u=o-r,c=n-i;return(s=s||new ct(16))[0]=2*n/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/u,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(o+r)/u,s[10]=i/c,s[11]=-1,s[12]=0,s[13]=0,s[14]=n*i/c,s[15]=0,s},aim:function(t,e,r,o){return o=o||new ct(16),gt=gt||m(),yt=yt||m(),wt=wt||m(),et(G(e,t,wt),wt),et($(r,wt,gt),gt),et($(wt,gt,yt),yt),o[0]=gt[0],o[1]=gt[1],o[2]=gt[2],o[3]=0,o[4]=yt[0],o[5]=yt[1],o[6]=yt[2],o[7]=0,o[8]=wt[0],o[9]=wt[1],o[10]=wt[2],o[11]=0,o[12]=t[0],o[13]=t[1],o[14]=t[2],o[15]=1,o},cameraAim:function(t,e,r,o){return o=o||new ct(16),gt=gt||m(),yt=yt||m(),wt=wt||m(),et(G(t,e,wt),wt),et($(r,wt,gt),gt),et($(wt,gt,yt),yt),o[0]=gt[0],o[1]=gt[1],o[2]=gt[2],o[3]=0,o[4]=yt[0],o[5]=yt[1],o[6]=yt[2],o[7]=0,o[8]=wt[0],o[9]=wt[1],o[10]=wt[2],o[11]=0,o[12]=t[0],o[13]=t[1],o[14]=t[2],o[15]=1,o},lookAt:function(t,e,r,o){return o=o||new ct(16),gt=gt||m(),yt=yt||m(),wt=wt||m(),et(G(t,e,wt),wt),et($(r,wt,gt),gt),et($(wt,gt,yt),yt),o[0]=gt[0],o[1]=yt[0],o[2]=wt[0],o[3]=0,o[4]=gt[1],o[5]=yt[1],o[6]=wt[1],o[7]=0,o[8]=gt[2],o[9]=yt[2],o[10]=wt[2],o[11]=0,o[12]=-(gt[0]*t[0]+gt[1]*t[1]+gt[2]*t[2]),o[13]=-(yt[0]*t[0]+yt[1]*t[1]+yt[2]*t[2]),o[14]=-(wt[0]*t[0]+wt[1]*t[1]+wt[2]*t[2]),o[15]=1,o},translation:function(t,e){return(e=e||new ct(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},translate:function(t,e,r){r=r||new ct(16);const o=e[0],n=e[1],i=e[2],s=t[0],a=t[1],u=t[2],c=t[3],l=t[4],p=t[5],h=t[6],d=t[7],m=t[8],f=t[9],_=t[10],g=t[11],y=t[12],w=t[13],x=t[14],v=t[15];return t!==r&&(r[0]=s,r[1]=a,r[2]=u,r[3]=c,r[4]=l,r[5]=p,r[6]=h,r[7]=d,r[8]=m,r[9]=f,r[10]=_,r[11]=g),r[12]=s*o+l*n+m*i+y,r[13]=a*o+p*n+f*i+w,r[14]=u*o+h*n+_*i+x,r[15]=c*o+d*n+g*i+v,r},rotationX:function(t,e){e=e||new ct(16);const r=Math.cos(t),o=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=o,e[7]=0,e[8]=0,e[9]=-o,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotateX:function(t,e,r){r=r||new ct(16);const o=t[4],n=t[5],i=t[6],s=t[7],a=t[8],u=t[9],c=t[10],l=t[11],p=Math.cos(e),h=Math.sin(e);return r[4]=p*o+h*a,r[5]=p*n+h*u,r[6]=p*i+h*c,r[7]=p*s+h*l,r[8]=p*a-h*o,r[9]=p*u-h*n,r[10]=p*c-h*i,r[11]=p*l-h*s,t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},rotationY:function(t,e){e=e||new ct(16);const r=Math.cos(t),o=Math.sin(t);return e[0]=r,e[1]=0,e[2]=-o,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=o,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotateY:function(t,e,r){r=r||new ct(16);const o=t[0],n=t[1],i=t[2],s=t[3],a=t[8],u=t[9],c=t[10],l=t[11],p=Math.cos(e),h=Math.sin(e);return r[0]=p*o-h*a,r[1]=p*n-h*u,r[2]=p*i-h*c,r[3]=p*s-h*l,r[8]=p*a+h*o,r[9]=p*u+h*n,r[10]=p*c+h*i,r[11]=p*l+h*s,t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},rotationZ:function(t,e){e=e||new ct(16);const r=Math.cos(t),o=Math.sin(t);return e[0]=r,e[1]=o,e[2]=0,e[3]=0,e[4]=-o,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotateZ:function(t,e,r){r=r||new ct(16);const o=t[0],n=t[1],i=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],p=Math.cos(e),h=Math.sin(e);return r[0]=p*o+h*a,r[1]=p*n+h*u,r[2]=p*i+h*c,r[3]=p*s+h*l,r[4]=p*a-h*o,r[5]=p*u-h*n,r[6]=p*c-h*i,r[7]=p*l-h*s,t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},axisRotation:xt,rotation:vt,axisRotate:bt,rotate:kt,scaling:function(t,e){return(e=e||new ct(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,r){r=r||new ct(16);const o=e[0],n=e[1],i=e[2];return r[0]=o*t[0],r[1]=o*t[1],r[2]=o*t[2],r[3]=o*t[3],r[4]=n*t[4],r[5]=n*t[5],r[6]=n*t[6],r[7]=n*t[7],r[8]=i*t[8],r[9]=i*t[9],r[10]=i*t[10],r[11]=i*t[11],t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},uniformScaling:function(t,e){return(e=e||new ct(16))[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},uniformScale:function(t,e,r){return(r=r||new ct(16))[0]=e*t[0],r[1]=e*t[1],r[2]=e*t[2],r[3]=e*t[3],r[4]=e*t[4],r[5]=e*t[5],r[6]=e*t[6],r[7]=e*t[7],r[8]=e*t[8],r[9]=e*t[9],r[10]=e*t[10],r[11]=e*t[11],t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}});let Mt=Float32Array;function St(t,e,r,o){const n=new Mt(4);return void 0!==t&&(n[0]=t,void 0!==e&&(n[1]=e,void 0!==r&&(n[2]=r,void 0!==o&&(n[3]=o)))),n}const Et=St;function At(t,e,r){r=r||new Mt(4);const o=.5*e,n=Math.sin(o);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(o),r}function It(t,e,r){r=r||new Mt(4);const o=t[0],n=t[1],i=t[2],s=t[3],a=e[0],u=e[1],c=e[2],l=e[3];return r[0]=o*l+s*a+n*c-i*u,r[1]=n*l+s*u+i*a-o*c,r[2]=i*l+s*c+o*u-n*a,r[3]=s*l-o*a-n*u-i*c,r}const Pt=It;function Ot(t,e,r,o){o=o||new Mt(4);const n=t[0],i=t[1],s=t[2],a=t[3];let u,c,p=e[0],h=e[1],d=e[2],m=e[3],f=n*p+i*h+s*d+a*m;if(f<0&&(f=-f,p=-p,h=-h,d=-d,m=-m),1-f>l){const t=Math.acos(f),e=Math.sin(t);u=Math.sin((1-r)*t)/e,c=Math.sin(r*t)/e}else u=1-r,c=r;return o[0]=u*n+c*p,o[1]=u*i+c*h,o[2]=u*s+c*d,o[3]=u*a+c*m,o}function Ut(t,e){return(e=e||new Mt(4))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const zt=Ut;function Nt(t,e,r){return(r=r||new Mt(4))[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}const Vt=Nt;function Dt(t,e,r){return(r=r||new Mt(4))[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}const qt=Dt;function Rt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Gt(t){const e=t[0],r=t[1],o=t[2],n=t[3];return Math.sqrt(e*e+r*r+o*o+n*n)}const Ct=Gt;function jt(t){const e=t[0],r=t[1],o=t[2],n=t[3];return e*e+r*r+o*o+n*n}const Lt=jt;function Ft(t,e){e=e||new Mt(4);const r=t[0],o=t[1],n=t[2],i=t[3],s=Math.sqrt(r*r+o*o+n*n+i*i);return s>1e-5?(e[0]=r/s,e[1]=o/s,e[2]=n/s,e[3]=i/s):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}let Bt,$t,Xt,Yt,Ht;var Wt=Object.freeze({__proto__:null,create:St,setDefaultType:function(t){const e=Mt;return Mt=t,e},fromValues:Et,set:function(t,e,r,o,n){return(n=n||new Mt(4))[0]=t,n[1]=e,n[2]=r,n[3]=o,n},fromAxisAngle:At,toAxisAngle:function(t,e){e=e||m(4);const r=2*Math.acos(t[3]),o=Math.sin(.5*r);return o>l?(e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o):(e[0]=1,e[1]=0,e[2]=0),{angle:r,axis:e}},angle:function(t,e){const r=Rt(t,e);return Math.acos(2*r*r-1)},multiply:It,mul:Pt,rotateX:function(t,e,r){r=r||new Mt(4);const o=.5*e,n=t[0],i=t[1],s=t[2],a=t[3],u=Math.sin(o),c=Math.cos(o);return r[0]=n*c+a*u,r[1]=i*c+s*u,r[2]=s*c-i*u,r[3]=a*c-n*u,r},rotateY:function(t,e,r){r=r||new Mt(4);const o=.5*e,n=t[0],i=t[1],s=t[2],a=t[3],u=Math.sin(o),c=Math.cos(o);return r[0]=n*c-s*u,r[1]=i*c+a*u,r[2]=s*c+n*u,r[3]=a*c-i*u,r},rotateZ:function(t,e,r){r=r||new Mt(4);const o=.5*e,n=t[0],i=t[1],s=t[2],a=t[3],u=Math.sin(o),c=Math.cos(o);return r[0]=n*c+i*u,r[1]=i*c-n*u,r[2]=s*c+a*u,r[3]=a*c-s*u,r},slerp:Ot,inverse:function(t,e){e=e||new Mt(4);const r=t[0],o=t[1],n=t[2],i=t[3],s=r*r+o*o+n*n+i*i,a=s?1/s:0;return e[0]=-r*a,e[1]=-o*a,e[2]=-n*a,e[3]=i*a,e},conjugate:function(t,e){return(e=e||new Mt(4))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat:function(t,e){e=e||new Mt(4);const r=t[0]+t[5]+t[10];if(r>0){const o=Math.sqrt(r+1);e[3]=.5*o;const n=.5/o;e[0]=(t[6]-t[9])*n,e[1]=(t[8]-t[2])*n,e[2]=(t[1]-t[4])*n}else{let r=0;t[5]>t[0]&&(r=1),t[10]>t[4*r+r]&&(r=2);const o=(r+1)%3,n=(r+2)%3,i=Math.sqrt(t[4*r+r]-t[4*o+o]-t[4*n+n]+1);e[r]=.5*i;const s=.5/i;e[3]=(t[4*o+n]-t[4*n+o])*s,e[o]=(t[4*o+r]+t[4*r+o])*s,e[n]=(t[4*n+r]+t[4*r+n])*s}return e},fromEuler:function(t,e,r,o,n){n=n||new Mt(4);const i=.5*t,s=.5*e,a=.5*r,u=Math.sin(i),c=Math.cos(i),l=Math.sin(s),p=Math.cos(s),h=Math.sin(a),d=Math.cos(a);switch(o){case"xyz":n[0]=u*p*d+c*l*h,n[1]=c*l*d-u*p*h,n[2]=c*p*h+u*l*d,n[3]=c*p*d-u*l*h;break;case"xzy":n[0]=u*p*d-c*l*h,n[1]=c*l*d-u*p*h,n[2]=c*p*h+u*l*d,n[3]=c*p*d+u*l*h;break;case"yxz":n[0]=u*p*d+c*l*h,n[1]=c*l*d-u*p*h,n[2]=c*p*h-u*l*d,n[3]=c*p*d+u*l*h;break;case"yzx":n[0]=u*p*d+c*l*h,n[1]=c*l*d+u*p*h,n[2]=c*p*h-u*l*d,n[3]=c*p*d-u*l*h;break;case"zxy":n[0]=u*p*d-c*l*h,n[1]=c*l*d+u*p*h,n[2]=c*p*h+u*l*d,n[3]=c*p*d-u*l*h;break;case"zyx":n[0]=u*p*d-c*l*h,n[1]=c*l*d+u*p*h,n[2]=c*p*h-u*l*d,n[3]=c*p*d+u*l*h;break;default:throw new Error(`Unknown rotation order: ${o}`)}return n},copy:Ut,clone:zt,add:function(t,e,r){return(r=r||new Mt(4))[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r},subtract:Nt,sub:Vt,mulScalar:Dt,scale:qt,divScalar:function(t,e,r){return(r=r||new Mt(4))[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r[3]=t[3]/e,r},dot:Rt,lerp:function(t,e,r,o){return(o=o||new Mt(4))[0]=t[0]+r*(e[0]-t[0]),o[1]=t[1]+r*(e[1]-t[1]),o[2]=t[2]+r*(e[2]-t[2]),o[3]=t[3]+r*(e[3]-t[3]),o},length:Gt,len:Ct,lengthSq:jt,lenSq:Lt,normalize:Ft,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<l&&Math.abs(t[1]-e[1])<l&&Math.abs(t[2]-e[2])<l&&Math.abs(t[3]-e[3])<l},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},identity:function(t){return(t=t||new Mt(4))[0]=0,t[1]=0,t[2]=0,t[3]=1,t},rotationTo:function(t,e,r){r=r||new Mt(4),Bt=Bt||m(),$t=$t||m(1,0,0),Xt=Xt||m(0,1,0);const o=X(t,e);return o<-.999999?($($t,t,Bt),H(Bt)<1e-6&&$(Xt,t,Bt),et(Bt,Bt),At(Bt,Math.PI,r),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):($(t,e,Bt),r[0]=Bt[0],r[1]=Bt[1],r[2]=Bt[2],r[3]=1+o,Ft(r,r))},sqlerp:function(t,e,r,o,n,i){return i=i||new Mt(4),Yt=Yt||new Mt(4),Ht=Ht||new Mt(4),Ot(t,o,n,Yt),Ot(e,r,n,Ht),Ot(Yt,Ht,2*n*(1-n),i),i}});Float32Array;const Qt={duration:.3,delay:0,endDelay:0,repeat:0,easing:"ease"},Zt=t=>1e3*t,Jt=t=>t/1e3,Kt=()=>{},te=t=>t;function ee(t,e=!0){if(t&&"finished"!==t.playState)try{t.stop?t.stop():(e&&t.commitStyles(),t.cancel())}catch(t){}}const re=t=>t(),oe=(t,e,r=Qt.duration)=>new Proxy({animations:t.map(re).filter(Boolean),duration:r,options:e},ne),ne={get:(t,e)=>{const r=t.animations[0];switch(e){case"duration":return t.duration;case"currentTime":return Jt((null==r?void 0:r[e])||0);case"playbackRate":case"playState":return null==r?void 0:r[e];case"finished":return t.finished||(t.finished=Promise.all(t.animations.map(ie)).catch(Kt)),t.finished;case"stop":return()=>{t.animations.forEach((t=>ee(t)))};case"forEachNative":return e=>{t.animations.forEach((r=>e(r,t)))};default:return void 0===(null==r?void 0:r[e])?void 0:()=>t.animations.forEach((t=>t[e]()))}},set:(t,e,r)=>{switch(e){case"currentTime":r=Zt(r);case"playbackRate":for(let o=0;o<t.animations.length;o++)t.animations[o][e]=r;return!0}return!1}},ie=t=>t.finished,se=t=>"object"==typeof t&&Boolean(t.createAnimation),ae=t=>"number"==typeof t,ue=t=>Array.isArray(t)&&!ae(t[0]),ce=(t,e,r)=>-r*t+r*e+t,le=(t,e,r)=>e-t==0?1:(r-t)/(e-t);function pe(t,e){const r=t[t.length-1];for(let o=1;o<=e;o++){const n=le(0,e,o);t.push(ce(r,1,n))}}const he=(t,e,r)=>Math.min(Math.max(r,t),e);const de=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,me=1e-7,fe=12;function _e(t,e,r,o){if(t===e&&r===o)return te;return n=>0===n||1===n?n:de(function(t,e,r,o,n){let i,s,a=0;do{s=e+(r-e)/2,i=de(s,o,n)-t,i>0?r=s:e=s}while(Math.abs(i)>me&&++a<fe);return s}(n,0,1,t,r),e,o)}const ge=t=>"function"==typeof t,ye=t=>Array.isArray(t)&&ae(t[0]),we={ease:_e(.25,.1,.25,1),"ease-in":_e(.42,0,1,1),"ease-in-out":_e(.42,0,.58,1),"ease-out":_e(0,0,.58,1)},xe=/\((.*?)\)/;function ve(t){if(ge(t))return t;if(ye(t))return _e(...t);if(we[t])return we[t];if(t.startsWith("steps")){const e=xe.exec(t);if(e){const t=e[1].split(",");return((t,e="end")=>r=>{const o=(r="end"===e?Math.min(r,.999):Math.max(r,.001))*t,n="end"===e?Math.floor(o):Math.ceil(o);return he(0,1,n/t)})(parseFloat(t[0]),t[1].trim())}}return te}class be{constructor(t,e=[0,1],{easing:r,duration:o=Qt.duration,delay:n=Qt.delay,endDelay:i=Qt.endDelay,repeat:s=Qt.repeat,offset:a,direction:u="normal"}={}){if(this.startTime=null,this.rate=1,this.t=0,this.cancelTimestamp=null,this.easing=te,this.duration=0,this.totalDuration=0,this.repeat=0,this.playState="idle",this.finished=new Promise(((t,e)=>{this.resolve=t,this.reject=e})),r=r||Qt.easing,se(r)){const t=r.createAnimation(e);r=t.easing,e=t.keyframes||e,o=t.duration||o}this.repeat=s,this.easing=ue(r)?te:ve(r),this.updateDuration(o);const c=function(t,e=function(t){const e=[0];return pe(e,t-1),e}(t.length),r=te){const o=t.length,n=o-e.length;return n>0&&pe(e,n),n=>{let i=0;for(;i<o-2&&!(n<e[i+1]);i++);let s=he(0,1,le(e[i],e[i+1],n));const a=function(t,e){return ue(t)?t[((t,e,r)=>{const o=e-t;return((r-t)%o+o)%o+t})(0,t.length,e)]:t}(r,i);return s=a(s),ce(t[i],t[i+1],s)}}(e,a,ue(r)?r.map(ve):te);this.tick=e=>{var r;let o=0;o=void 0!==this.pauseTime?this.pauseTime:(e-this.startTime)*this.rate,this.t=o,o/=1e3,o=Math.max(o-n,0),"finished"===this.playState&&void 0===this.pauseTime&&(o=this.totalDuration);const s=o/this.duration;let a=Math.floor(s),l=s%1;!l&&s>=1&&(l=1),1===l&&a--;const p=a%2;("reverse"===u||"alternate"===u&&p||"alternate-reverse"===u&&!p)&&(l=1-l);const h=o>=this.totalDuration?1:Math.min(l,1),d=c(this.easing(h));t(d),void 0===this.pauseTime&&("finished"===this.playState||o>=this.totalDuration+i)?(this.playState="finished",null===(r=this.resolve)||void 0===r||r.call(this,d)):"idle"!==this.playState&&(this.frameRequestId=requestAnimationFrame(this.tick))},this.play()}play(){const t=performance.now();this.playState="running",void 0!==this.pauseTime?this.startTime=t-this.pauseTime:this.startTime||(this.startTime=t),this.cancelTimestamp=this.startTime,this.pauseTime=void 0,this.frameRequestId=requestAnimationFrame(this.tick)}pause(){this.playState="paused",this.pauseTime=this.t}finish(){this.playState="finished",this.tick(0)}stop(){var t;this.playState="idle",void 0!==this.frameRequestId&&cancelAnimationFrame(this.frameRequestId),null===(t=this.reject)||void 0===t||t.call(this,!1)}cancel(){this.stop(),this.tick(this.cancelTimestamp)}reverse(){this.rate*=-1}commitStyles(){}updateDuration(t){this.duration=t,this.totalDuration=t*(this.repeat+1)}get currentTime(){return this.t}set currentTime(t){void 0!==this.pauseTime||0===this.rate?this.pauseTime=t:this.startTime=performance.now()-t/this.rate}get playbackRate(){return this.rate}set playbackRate(t){this.rate=t}}class ke{setAnimation(t){this.animation=t,null==t||t.finished.then((()=>this.clearAnimation())).catch((()=>{}))}clearAnimation(){this.animation=this.generator=void 0}}const Te=new WeakMap;function Me(t){return Te.has(t)||Te.set(t,{transforms:[],values:new Map}),Te.get(t)}const Se=["","X","Y","Z"],Ee={x:"translateX",y:"translateY",z:"translateZ"},Ae={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:t=>t+"deg"},Ie={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:t=>t+"px"},rotate:Ae,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:te},skew:Ae},Pe=new Map,Oe=t=>`--motion-${t}`,Ue=["x","y","z"];["translate","scale","rotate","skew"].forEach((t=>{Se.forEach((e=>{Ue.push(t+e),Pe.set(Oe(t+e),Ie[t])}))}));const ze=(t,e)=>Ue.indexOf(t)-Ue.indexOf(e),Ne=new Set(Ue),Ve=t=>Ne.has(t),De=t=>t.sort(ze).reduce(qe,"").trim(),qe=(t,e)=>`${t} ${e}(var(${Oe(e)}))`,Re=t=>t.startsWith("--"),Ge=new Set,Ce=(t,e)=>document.createElement("div").animate(t,e),je={cssRegisterProperty:()=>"undefined"!=typeof CSS&&Object.hasOwnProperty.call(CSS,"registerProperty"),waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate"),partialKeyframes:()=>{try{Ce({opacity:[1]})}catch(t){return!1}return!0},finished:()=>Boolean(Ce({opacity:[0,1]},{duration:.001}).finished),linearEasing:()=>{try{Ce({opacity:0},{easing:"linear(0, 1)"})}catch(t){return!1}return!0}},Le={},Fe={};for(const t in je)Fe[t]=()=>(void 0===Le[t]&&(Le[t]=je[t]()),Le[t]);const Be=(t,e)=>ge(t)?Fe.linearEasing()?`linear(${((t,e)=>{let r="";const o=Math.round(e/.015);for(let e=0;e<o;e++)r+=t(le(0,o-1,e))+", ";return r.substring(0,r.length-2)})(t,e)})`:Qt.easing:ye(t)?$e(t):t,$e=([t,e,r,o])=>`cubic-bezier(${t}, ${e}, ${r}, ${o})`;function Xe(t){return Ee[t]&&(t=Ee[t]),Ve(t)?Oe(t):t}const Ye=(t,e)=>{e=Xe(e);let r=Re(e)?t.style.getPropertyValue(e):getComputedStyle(t)[e];if(!r&&0!==r){const t=Pe.get(e);t&&(r=t.initialValue)}return r},He=(t,e,r)=>{e=Xe(e),Re(e)?t.style.setProperty(e,r):t.style[e]=r},We=t=>"string"==typeof t;function Qe(t,e){var r;let o=(null==e?void 0:e.toDefaultUnit)||te;const n=t[t.length-1];if(We(n)){const t=(null===(r=n.match(/(-?[\d.]+)([a-z%]*)/))||void 0===r?void 0:r[2])||"";t&&(o=e=>e+t)}return o}function Ze(t,e,r,o={},n){const i=window.__MOTION_DEV_TOOLS_RECORD,s=!1!==o.record&&i;let a,{duration:u=Qt.duration,delay:c=Qt.delay,endDelay:l=Qt.endDelay,repeat:p=Qt.repeat,easing:h=Qt.easing,persist:d=!1,direction:m,offset:f,allowWebkitAcceleration:_=!1}=o;const g=Me(t),y=Ve(e);let w=Fe.waapi();y&&((t,e)=>{Ee[e]&&(e=Ee[e]);const{transforms:r}=Me(t);var o,n;n=e,-1===(o=r).indexOf(n)&&o.push(n),t.style.transform=De(r)})(t,e);const x=Xe(e),v=function(t,e){return t.has(e)||t.set(e,new ke),t.get(e)}(g.values,x),b=Pe.get(x);return ee(v.animation,!(se(h)&&v.generator)&&!1!==o.record),()=>{const g=()=>{var e,r;return null!==(r=null!==(e=Ye(t,x))&&void 0!==e?e:null==b?void 0:b.initialValue)&&void 0!==r?r:0};let k=function(t,e){for(let r=0;r<t.length;r++)null===t[r]&&(t[r]=r?t[r-1]:e());return t}((t=>Array.isArray(t)?t:[t])(r),g);const T=Qe(k,b);if(se(h)){const t=h.createAnimation(k,"opacity"!==e,g,x,v);h=t.easing,k=t.keyframes||k,u=t.duration||u}if(Re(x)&&(Fe.cssRegisterProperty()?function(t){if(!Ge.has(t)){Ge.add(t);try{const{syntax:e,initialValue:r}=Pe.has(t)?Pe.get(t):{};CSS.registerProperty({name:t,inherits:!1,syntax:e,initialValue:r})}catch(t){}}}(x):w=!1),y&&!Fe.linearEasing()&&(ge(h)||ue(h)&&h.some(ge))&&(w=!1),w){b&&(k=k.map((t=>ae(t)?b.toDefaultUnit(t):t))),1!==k.length||Fe.partialKeyframes()&&!s||k.unshift(g());const e={delay:Zt(c),duration:Zt(u),endDelay:Zt(l),easing:ue(h)?void 0:Be(h,u),direction:m,iterations:p+1,fill:"both"};a=t.animate({[x]:k,offset:f,easing:ue(h)?h.map((t=>Be(t,u))):void 0},e),a.finished||(a.finished=new Promise(((t,e)=>{a.onfinish=t,a.oncancel=e})));const r=k[k.length-1];a.finished.then((()=>{d||(He(t,x,r),a.cancel())})).catch(Kt),_||(a.playbackRate=1.000001)}else if(n&&y)k=k.map((t=>"string"==typeof t?parseFloat(t):t)),1===k.length&&k.unshift(parseFloat(g())),a=new n((e=>{He(t,x,T?T(e):e)}),k,Object.assign(Object.assign({},o),{duration:u,easing:h}));else{const e=k[k.length-1];He(t,x,b&&ae(e)?b.toDefaultUnit(e):e)}return s&&i(t,e,k,{duration:u,delay:c,easing:h,repeat:p,offset:f},"motion-one"),v.setAnimation(a),a}}const Je=(t,e)=>t[e]?Object.assign(Object.assign({},t),t[e]):Object.assign({},t);function Ke(t,e,r){return ge(t)?t(e,r):t}const tr=(er=be,function(t,e,r={}){const o=(t=function(t,e){return"string"==typeof t?t=document.querySelectorAll(t):t instanceof Element&&(t=[t]),Array.from(t||[])}(t)).length;Boolean(o),Boolean(e);const n=[];for(let i=0;i<o;i++){const s=t[i];for(const t in e){const a=Je(r,t);a.delay=Ke(a.delay,i,o);const u=Ze(s,t,e[t],a,er);n.push(u)}}return oe(n,r,r.duration)});var er;function rr(t,e={}){return oe([()=>{const r=new be(t,[0,1],e);return r.finished.catch((()=>{})),r}],e,e.duration)}function or(t,e,r){return(ge(t)?rr:tr)(t,e,r)}function nr(t,e,r){const o=Math.max(e-5,0);return n=r-t(o),(i=e-o)?n*(1e3/i):0;var n,i}function ir(t){return ae(t)&&!isNaN(t)}function sr(t){return We(t)?parseFloat(t):t}const ar=function(t){const e=new WeakMap;return(t={})=>{const r=new Map,o=(e=0,o=100,n=0,i=!1)=>{const s=`${e}-${o}-${n}-${i}`;return r.has(s)||r.set(s,(({from:t=0,velocity:e=0,power:r=.8,decay:o=.325,bounceDamping:n,bounceStiffness:i,changeTarget:s,min:a,max:u,restDistance:c=.5,restSpeed:l})=>{o=Zt(o);const p={hasReachedTarget:!1,done:!1,current:t,target:t},h=t=>void 0===a?u:void 0===u||Math.abs(a-t)<Math.abs(u-t)?a:u;let d=r*e;const m=t+d,f=void 0===s?m:s(m);p.target=f,f!==m&&(d=f-t);const _=t=>-d*Math.exp(-t/o),g=t=>f+_(t),y=t=>{const e=_(t),r=g(t);p.done=Math.abs(e)<=c,p.current=p.done?f:r};let w,x;const v=t=>{var e;e=p.current,(void 0!==a&&e<a||void 0!==u&&e>u)&&(w=t,x=(({stiffness:t=100,damping:e=10,mass:r=1,from:o=0,to:n=1,velocity:i=0,restSpeed:s,restDistance:a}={})=>{i=i?Jt(i):0;const u={done:!1,hasReachedTarget:!1,current:o,target:n},c=n-o,l=Math.sqrt(t/r)/1e3,p=((t=100,e=10,r=1)=>e/(2*Math.sqrt(t*r)))(t,e,r),h=Math.abs(c)<5;let d;if(s||(s=h?.01:2),a||(a=h?.005:.5),p<1){const t=l*Math.sqrt(1-p*p);d=e=>n-Math.exp(-p*l*e)*((p*l*c-i)/t*Math.sin(t*e)+c*Math.cos(t*e))}else d=t=>n-Math.exp(-l*t)*(c+(l*c-i)*t);return t=>{u.current=d(t);const e=0===t?i:nr(d,t,u.current),r=Math.abs(e)<=s,c=Math.abs(n-u.current)<=a;var l,p,h;return u.done=r&&c,u.hasReachedTarget=(l=o,p=n,h=u.current,l<p&&h>=p||l>p&&h<=p),u}})({from:p.current,to:h(p.current),velocity:nr(g,t,p.current),damping:n,stiffness:i,restDistance:c,restSpeed:l}))};return v(0),t=>{let e=!1;return x||void 0!==w||(e=!0,y(t),v(t)),void 0!==w&&t>w?(p.hasReachedTarget=!0,x(t-w)):(p.hasReachedTarget=!1,!e&&y(t),p)}})(Object.assign({from:e,to:o,velocity:n},t))),r.get(s)},n=(t,r)=>(e.has(t)||e.set(t,function(t,e=te){let r,o=10,n=t(0);const i=[e(n.current)];for(;!n.done&&o<1e4;)n=t(o),i.push(e(n.done?n.target:n.current)),void 0===r&&n.hasReachedTarget&&(r=o),o+=10;const s=o-10;return 1===i.length&&i.push(n.current),{keyframes:i,duration:s/1e3,overshootDuration:(null!=r?r:s)/1e3}}(t,r)),e.get(t));return{createAnimation:(t,e=!0,r,i,s)=>{let a,u,c,l=0,p=te;const h=t.length;if(e)if(p=Qe(t,i?Pe.get(Xe(i)):void 0),c=sr(t[h-1]),h>1&&null!==t[0])u=sr(t[0]);else{const t=null==s?void 0:s.generator;if(t){const{animation:e,generatorStartTime:r}=s,o=(null==e?void 0:e.startTime)||r||0,n=(null==e?void 0:e.currentTime)||performance.now()-o,i=t(n).current;u=i,l=nr((e=>t(e).current),n,i)}else r&&(u=sr(r()))}if(ir(u)&&ir(c)){const t=o(u,c,l,null==i?void 0:i.includes("scale"));a=Object.assign(Object.assign({},n(t,p)),{easing:"linear"}),s&&(s.generator=t,s.generatorStartTime=performance.now())}return a||(a={easing:"ease",duration:n(o(0,100)).overshootDuration}),a}}}}();class ur{position;targetPosition;rotation;targetRotation;scale;targetScale;constructor(t){this.position=t.position,this.rotation=t.rotation,this.targetPosition=this.position,this.targetRotation=this.rotation,this.scale=ut.create(1,1,1),this.targetScale=this.scale}update(){or((t=>{this.position=ut.lerp(this.position,this.targetPosition,t)}),{easing:ar({velocity:2e-4*hn})}),or((t=>{this.rotation=Wt.slerp(this.rotation,this.targetRotation,t)}),{easing:ar({velocity:2e-4*hn})}),or((t=>{this.scale=ut.lerp(this.scale,this.targetScale,t)}),{easing:ar({velocity:2e-4*hn})})}}const cr=new class{pressed={w:!1,a:!1,s:!1,d:!1," ":!1,control:!1};constructor(){window.addEventListener("keydown",(t=>{const e=t.key.toLowerCase();this.pressed[e]=!0})),window.addEventListener("keyup",(t=>{const e=t.key.toLowerCase();this.pressed[e]=!1}))}};var lr=r(274),pr=r.n(lr),hr=r(509),dr=r.n(hr);const mr=t=>{const e=t.createShaderModule({code:"@group(0) @binding(0) var mySampler : sampler;\r\n@group(0) @binding(1) var myTexture : texture_2d<f32>;\r\n//@group(0) @binding(2) var debugTexture : texture_2d<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) fragUV : vec2<f32>,\r\n}\r\n\r\n@vertex\r\nfn vertex_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r\n  const pos = array(\r\n    vec2( 1.0,  1.0),\r\n    vec2( 1.0, -1.0),\r\n    vec2(-1.0, -1.0),\r\n    vec2( 1.0,  1.0),\r\n    vec2(-1.0, -1.0),\r\n    vec2(-1.0,  1.0),\r\n  );\r\n\r\n  const uv = array(\r\n    vec2(1.0, 0.0),\r\n    vec2(1.0, 1.0),\r\n    vec2(0.0, 1.0),\r\n    vec2(1.0, 0.0),\r\n    vec2(0.0, 1.0),\r\n    vec2(0.0, 0.0),\r\n  );\r\n\r\n  var output : VertexOutput;\r\n  output.Position = vec4(pos[VertexIndex], 0.0, 1.0);\r\n  output.fragUV = uv[VertexIndex];\r\n  return output;\r\n}\r\n\r\nfn get_debug_colour(index : i32) -> vec4<f32> {\r\n  let colours = array(\r\n    vec4<f32>(1.0, 0.0, 0.0, 1.0),\r\n    vec4<f32>(0.0, 1.0, 0.0, 1.0),\r\n    vec4<f32>(0.0, 0.0, 1.0, 1.0),\r\n    vec4<f32>(1.0, 1.0, 0.0, 1.0),\r\n    vec4<f32>(1.0, 0.0, 1.0, 1.0),\r\n    vec4<f32>(0.0, 1.0, 1.0, 1.0),\r\n    vec4<f32>(1.0, 1.0, 1.0, 1.0),\r\n    vec4<f32>(0.0, 0.0, 0.0, 1.0),\r\n  );\r\n  return colours[index % 8];\r\n}\r\n\r\n@fragment\r\nfn fragment_main(@location(0) fragUV : vec2<f32>) -> @location(0) vec4<f32> {\r\n    return abs(textureSample(myTexture, mySampler, fragUV));\r\n}\r\n"}),r=t.createRenderPipeline({layout:"auto",vertex:{module:e,entryPoint:"vertex_main"},fragment:{module:e,entryPoint:"fragment_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]}});return{render:e=>{const o=e.commandEncoder.beginRenderPass({colorAttachments:[{view:nn.getCurrentTexture().createView(),loadOp:"clear",clearValue:[.3,.3,.3,1],storeOp:"store"}]}),n=t.createBindGroup({layout:r.getBindGroupLayout(0),entries:[{binding:0,resource:t.createSampler({magFilter:"linear",minFilter:"linear"})},{binding:1,resource:e.outputTextureViews.finalTexture}]});o.setPipeline(r),o.setBindGroup(0,n),o.draw(6),o.end()}}},fr=t=>t&&"number"==typeof t.length&&t.buffer instanceof ArrayBuffer&&"number"==typeof t.byteLength,_r={i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}},gr={..._r,"vec2<i32>":_r.vec2i,"vec2<u32>":_r.vec2u,"vec2<f32>":_r.vec2f,"vec2<f16>":_r.vec2h,"vec3<i32>":_r.vec3i,"vec3<u32>":_r.vec3u,"vec3<f32>":_r.vec3f,"vec3<f16>":_r.vec3h,"vec4<i32>":_r.vec4i,"vec4<u32>":_r.vec4u,"vec4<f32>":_r.vec4f,"vec4<f16>":_r.vec4h,"mat2x2<f32>":_r.mat2x2f,"mat2x2<f16>":_r.mat2x2h,"mat3x2<f32>":_r.mat3x2f,"mat3x2<f16>":_r.mat3x2h,"mat4x2<f32>":_r.mat4x2f,"mat4x2<f16>":_r.mat4x2h,"mat2x3<f32>":_r.mat2x3f,"mat2x3<f16>":_r.mat2x3h,"mat3x3<f32>":_r.mat3x3f,"mat3x3<f16>":_r.mat3x3h,"mat4x3<f32>":_r.mat4x3f,"mat4x3<f16>":_r.mat4x3h,"mat2x4<f32>":_r.mat2x4f,"mat2x4<f16>":_r.mat2x4h,"mat3x4<f32>":_r.mat3x4f,"mat3x4<f16>":_r.mat3x4h,"mat4x4<f32>":_r.mat4x4f,"mat4x4<f16>":_r.mat4x4h},yr=(wr=gr,Object.keys(wr));var wr,xr,vr,br,kr,Tr;!function(t=[],e){const r=new Set;for(const o of yr){const n=gr[o];r.has(n)||(r.add(n),n.flatten=t.includes(o)?e:!e)}}(),new WeakMap;class Mr{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Sr{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}}class Er extends Sr{constructor(){super()}}class Ar extends Er{constructor(t,e,r,o){super(),this.name=t,this.args=e,this.returnType=r,this.body=o}get astNodeType(){return"function"}}class Ir extends Er{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}}class Pr extends Er{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}}class Or extends Er{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}}class Ur extends Er{constructor(t,e,r,o){super(),this.init=t,this.condition=e,this.increment=r,this.body=o}get astNodeType(){return"for"}}class zr extends Er{constructor(t,e,r,o,n){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=n}get astNodeType(){return"var"}}class Nr extends Er{constructor(t,e,r){super(),this.name=t,this.type=e,this.value=r}get astNodeType(){return"override"}}class Vr extends Er{constructor(t,e,r,o,n){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=n}get astNodeType(){return"let"}}class Dr extends Er{constructor(t,e,r,o,n){super(),this.name=t,this.type=e,this.storage=r,this.access=o,this.value=n}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}}!function(t){t.increment="++",t.decrement="--"}(xr||(xr={})),function(t){t.parse=function(e){const r=e;if("parse"==r)throw new Error("Invalid value for IncrementOperator");return t[r]}}(xr||(xr={}));class qr extends Er{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}}!function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="}(vr||(vr={})),function(t){t.parse=function(e){const r=e;if("parse"==r)throw new Error("Invalid value for AssignOperator");return t[r]}}(vr||(vr={}));class Rr extends Er{constructor(t,e,r){super(),this.operator=t,this.variable=e,this.value=r}get astNodeType(){return"assign"}}class Gr extends Er{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}}class Cr extends Er{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class jr extends Er{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"body"}}class Lr extends Er{constructor(t,e,r,o){super(),this.condition=t,this.body=e,this.elseif=r,this.else=o}get astNodeType(){return"if"}}class Fr extends Er{constructor(t){super(),this.value=t}get astNodeType(){return"return"}}class Br extends Er{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class $r extends Er{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Xr extends Er{constructor(){super()}get astNodeType(){return"discard"}}class Yr extends Er{constructor(){super()}get astNodeType(){return"break"}}class Hr extends Er{constructor(){super()}get astNodeType(){return"continue"}}class Wr extends Er{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Qr extends Wr{constructor(t,e){super(t),this.members=e}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}}class Zr extends Wr{constructor(t,e,r){super(t),this.format=e,this.access=r}get astNodeType(){return"template"}}class Jr extends Wr{constructor(t,e,r,o){super(t),this.storage=e,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class Kr extends Wr{constructor(t,e,r,o){super(t),this.attributes=e,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class to extends Wr{constructor(t,e,r){super(t),this.format=e,this.access=r}get astNodeType(){return"sampler"}}class eo extends Sr{constructor(){super()}}class ro extends eo{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class oo extends eo{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}}class no extends eo{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return 180*this.args[0].evaluate(t)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}}class io extends eo{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}}class so extends eo{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}evaluate(t){var e,r;if(this.initializer instanceof oo){const o=null===(e=this.postfix)||void 0===e?void 0:e.evaluateString(t),n=null===(r=this.initializer.type)||void 0===r?void 0:r.name,i=t.structs.get(n),s=null==i?void 0:i.getMemberIndex(o);if(-1!=s)return this.initializer.args[s].evaluate(t);console.log(s)}return this.initializer.evaluate(t)}}class ao extends eo{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class uo extends eo{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}}class co extends eo{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"typecastExpr"}evaluate(t){return this.args[0].evaluate(t)}}class lo extends eo{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}}class po extends eo{constructor(){super()}}class ho extends po{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}}class mo extends po{constructor(t,e,r){super(),this.operator=t,this.left=e,this.right=r}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class fo extends Sr{constructor(){super()}}class _o extends fo{constructor(t,e){super(),this.selector=t,this.body=e}get astNodeType(){return"case"}}class go extends fo{constructor(t){super(),this.body=t}get astNodeType(){return"default"}}class yo extends Sr{constructor(t,e,r){super(),this.name=t,this.type=e,this.attributes=r}get astNodeType(){return"argument"}}class wo extends Sr{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}}class xo extends Sr{constructor(t,e,r){super(),this.name=t,this.type=e,this.attributes=r}get astNodeType(){return"member"}}class vo extends Sr{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}!function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"}(kr||(kr={}));class bo{constructor(t,e,r){this.name=t,this.type=e,this.rule=r}toString(){return this.name}}class ko{}br=ko,ko.none=new bo("",kr.reserved,""),ko.eof=new bo("EOF",kr.token,""),ko.reserved={asm:new bo("asm",kr.reserved,"asm"),bf16:new bo("bf16",kr.reserved,"bf16"),do:new bo("do",kr.reserved,"do"),enum:new bo("enum",kr.reserved,"enum"),f16:new bo("f16",kr.reserved,"f16"),f64:new bo("f64",kr.reserved,"f64"),handle:new bo("handle",kr.reserved,"handle"),i8:new bo("i8",kr.reserved,"i8"),i16:new bo("i16",kr.reserved,"i16"),i64:new bo("i64",kr.reserved,"i64"),mat:new bo("mat",kr.reserved,"mat"),premerge:new bo("premerge",kr.reserved,"premerge"),regardless:new bo("regardless",kr.reserved,"regardless"),typedef:new bo("typedef",kr.reserved,"typedef"),u8:new bo("u8",kr.reserved,"u8"),u16:new bo("u16",kr.reserved,"u16"),u64:new bo("u64",kr.reserved,"u64"),unless:new bo("unless",kr.reserved,"unless"),using:new bo("using",kr.reserved,"using"),vec:new bo("vec",kr.reserved,"vec"),void:new bo("void",kr.reserved,"void")},ko.keywords={array:new bo("array",kr.keyword,"array"),atomic:new bo("atomic",kr.keyword,"atomic"),bool:new bo("bool",kr.keyword,"bool"),f32:new bo("f32",kr.keyword,"f32"),i32:new bo("i32",kr.keyword,"i32"),mat2x2:new bo("mat2x2",kr.keyword,"mat2x2"),mat2x3:new bo("mat2x3",kr.keyword,"mat2x3"),mat2x4:new bo("mat2x4",kr.keyword,"mat2x4"),mat3x2:new bo("mat3x2",kr.keyword,"mat3x2"),mat3x3:new bo("mat3x3",kr.keyword,"mat3x3"),mat3x4:new bo("mat3x4",kr.keyword,"mat3x4"),mat4x2:new bo("mat4x2",kr.keyword,"mat4x2"),mat4x3:new bo("mat4x3",kr.keyword,"mat4x3"),mat4x4:new bo("mat4x4",kr.keyword,"mat4x4"),ptr:new bo("ptr",kr.keyword,"ptr"),sampler:new bo("sampler",kr.keyword,"sampler"),sampler_comparison:new bo("sampler_comparison",kr.keyword,"sampler_comparison"),struct:new bo("struct",kr.keyword,"struct"),texture_1d:new bo("texture_1d",kr.keyword,"texture_1d"),texture_2d:new bo("texture_2d",kr.keyword,"texture_2d"),texture_2d_array:new bo("texture_2d_array",kr.keyword,"texture_2d_array"),texture_3d:new bo("texture_3d",kr.keyword,"texture_3d"),texture_cube:new bo("texture_cube",kr.keyword,"texture_cube"),texture_cube_array:new bo("texture_cube_array",kr.keyword,"texture_cube_array"),texture_multisampled_2d:new bo("texture_multisampled_2d",kr.keyword,"texture_multisampled_2d"),texture_storage_1d:new bo("texture_storage_1d",kr.keyword,"texture_storage_1d"),texture_storage_2d:new bo("texture_storage_2d",kr.keyword,"texture_storage_2d"),texture_storage_2d_array:new bo("texture_storage_2d_array",kr.keyword,"texture_storage_2d_array"),texture_storage_3d:new bo("texture_storage_3d",kr.keyword,"texture_storage_3d"),texture_depth_2d:new bo("texture_depth_2d",kr.keyword,"texture_depth_2d"),texture_depth_2d_array:new bo("texture_depth_2d_array",kr.keyword,"texture_depth_2d_array"),texture_depth_cube:new bo("texture_depth_cube",kr.keyword,"texture_depth_cube"),texture_depth_cube_array:new bo("texture_depth_cube_array",kr.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new bo("texture_depth_multisampled_2d",kr.keyword,"texture_depth_multisampled_2d"),texture_external:new bo("texture_external",kr.keyword,"texture_external"),u32:new bo("u32",kr.keyword,"u32"),vec2:new bo("vec2",kr.keyword,"vec2"),vec3:new bo("vec3",kr.keyword,"vec3"),vec4:new bo("vec4",kr.keyword,"vec4"),bitcast:new bo("bitcast",kr.keyword,"bitcast"),block:new bo("block",kr.keyword,"block"),break:new bo("break",kr.keyword,"break"),case:new bo("case",kr.keyword,"case"),continue:new bo("continue",kr.keyword,"continue"),continuing:new bo("continuing",kr.keyword,"continuing"),default:new bo("default",kr.keyword,"default"),discard:new bo("discard",kr.keyword,"discard"),else:new bo("else",kr.keyword,"else"),enable:new bo("enable",kr.keyword,"enable"),fallthrough:new bo("fallthrough",kr.keyword,"fallthrough"),false:new bo("false",kr.keyword,"false"),fn:new bo("fn",kr.keyword,"fn"),for:new bo("for",kr.keyword,"for"),function:new bo("function",kr.keyword,"function"),if:new bo("if",kr.keyword,"if"),let:new bo("let",kr.keyword,"let"),const:new bo("const",kr.keyword,"const"),loop:new bo("loop",kr.keyword,"loop"),while:new bo("while",kr.keyword,"while"),private:new bo("private",kr.keyword,"private"),read:new bo("read",kr.keyword,"read"),read_write:new bo("read_write",kr.keyword,"read_write"),return:new bo("return",kr.keyword,"return"),storage:new bo("storage",kr.keyword,"storage"),switch:new bo("switch",kr.keyword,"switch"),true:new bo("true",kr.keyword,"true"),alias:new bo("alias",kr.keyword,"alias"),type:new bo("type",kr.keyword,"type"),uniform:new bo("uniform",kr.keyword,"uniform"),var:new bo("var",kr.keyword,"var"),override:new bo("override",kr.keyword,"override"),workgroup:new bo("workgroup",kr.keyword,"workgroup"),write:new bo("write",kr.keyword,"write"),r8unorm:new bo("r8unorm",kr.keyword,"r8unorm"),r8snorm:new bo("r8snorm",kr.keyword,"r8snorm"),r8uint:new bo("r8uint",kr.keyword,"r8uint"),r8sint:new bo("r8sint",kr.keyword,"r8sint"),r16uint:new bo("r16uint",kr.keyword,"r16uint"),r16sint:new bo("r16sint",kr.keyword,"r16sint"),r16float:new bo("r16float",kr.keyword,"r16float"),rg8unorm:new bo("rg8unorm",kr.keyword,"rg8unorm"),rg8snorm:new bo("rg8snorm",kr.keyword,"rg8snorm"),rg8uint:new bo("rg8uint",kr.keyword,"rg8uint"),rg8sint:new bo("rg8sint",kr.keyword,"rg8sint"),r32uint:new bo("r32uint",kr.keyword,"r32uint"),r32sint:new bo("r32sint",kr.keyword,"r32sint"),r32float:new bo("r32float",kr.keyword,"r32float"),rg16uint:new bo("rg16uint",kr.keyword,"rg16uint"),rg16sint:new bo("rg16sint",kr.keyword,"rg16sint"),rg16float:new bo("rg16float",kr.keyword,"rg16float"),rgba8unorm:new bo("rgba8unorm",kr.keyword,"rgba8unorm"),rgba8unorm_srgb:new bo("rgba8unorm_srgb",kr.keyword,"rgba8unorm_srgb"),rgba8snorm:new bo("rgba8snorm",kr.keyword,"rgba8snorm"),rgba8uint:new bo("rgba8uint",kr.keyword,"rgba8uint"),rgba8sint:new bo("rgba8sint",kr.keyword,"rgba8sint"),bgra8unorm:new bo("bgra8unorm",kr.keyword,"bgra8unorm"),bgra8unorm_srgb:new bo("bgra8unorm_srgb",kr.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new bo("rgb10a2unorm",kr.keyword,"rgb10a2unorm"),rg11b10float:new bo("rg11b10float",kr.keyword,"rg11b10float"),rg32uint:new bo("rg32uint",kr.keyword,"rg32uint"),rg32sint:new bo("rg32sint",kr.keyword,"rg32sint"),rg32float:new bo("rg32float",kr.keyword,"rg32float"),rgba16uint:new bo("rgba16uint",kr.keyword,"rgba16uint"),rgba16sint:new bo("rgba16sint",kr.keyword,"rgba16sint"),rgba16float:new bo("rgba16float",kr.keyword,"rgba16float"),rgba32uint:new bo("rgba32uint",kr.keyword,"rgba32uint"),rgba32sint:new bo("rgba32sint",kr.keyword,"rgba32sint"),rgba32float:new bo("rgba32float",kr.keyword,"rgba32float"),static_assert:new bo("static_assert",kr.keyword,"static_assert")},ko.tokens={decimal_float_literal:new bo("decimal_float_literal",kr.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new bo("hex_float_literal",kr.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new bo("int_literal",kr.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new bo("uint_literal",kr.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new bo("ident",kr.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new bo("and",kr.token,"&"),and_and:new bo("and_and",kr.token,"&&"),arrow:new bo("arrow ",kr.token,"->"),attr:new bo("attr",kr.token,"@"),attr_left:new bo("attr_left",kr.token,"[["),attr_right:new bo("attr_right",kr.token,"]]"),forward_slash:new bo("forward_slash",kr.token,"/"),bang:new bo("bang",kr.token,"!"),bracket_left:new bo("bracket_left",kr.token,"["),bracket_right:new bo("bracket_right",kr.token,"]"),brace_left:new bo("brace_left",kr.token,"{"),brace_right:new bo("brace_right",kr.token,"}"),colon:new bo("colon",kr.token,":"),comma:new bo("comma",kr.token,","),equal:new bo("equal",kr.token,"="),equal_equal:new bo("equal_equal",kr.token,"=="),not_equal:new bo("not_equal",kr.token,"!="),greater_than:new bo("greater_than",kr.token,">"),greater_than_equal:new bo("greater_than_equal",kr.token,">="),shift_right:new bo("shift_right",kr.token,">>"),less_than:new bo("less_than",kr.token,"<"),less_than_equal:new bo("less_than_equal",kr.token,"<="),shift_left:new bo("shift_left",kr.token,"<<"),modulo:new bo("modulo",kr.token,"%"),minus:new bo("minus",kr.token,"-"),minus_minus:new bo("minus_minus",kr.token,"--"),period:new bo("period",kr.token,"."),plus:new bo("plus",kr.token,"+"),plus_plus:new bo("plus_plus",kr.token,"++"),or:new bo("or",kr.token,"|"),or_or:new bo("or_or",kr.token,"||"),paren_left:new bo("paren_left",kr.token,"("),paren_right:new bo("paren_right",kr.token,")"),semicolon:new bo("semicolon",kr.token,";"),star:new bo("star",kr.token,"*"),tilde:new bo("tilde",kr.token,"~"),underscore:new bo("underscore",kr.token,"_"),xor:new bo("xor",kr.token,"^"),plus_equal:new bo("plus_equal",kr.token,"+="),minus_equal:new bo("minus_equal",kr.token,"-="),times_equal:new bo("times_equal",kr.token,"*="),division_equal:new bo("division_equal",kr.token,"/="),modulo_equal:new bo("modulo_equal",kr.token,"%="),and_equal:new bo("and_equal",kr.token,"&="),or_equal:new bo("or_equal",kr.token,"|="),xor_equal:new bo("xor_equal",kr.token,"^="),shift_right_equal:new bo("shift_right_equal",kr.token,">>="),shift_left_equal:new bo("shift_left_equal",kr.token,"<<=")},ko.storage_class=[br.keywords.function,br.keywords.private,br.keywords.workgroup,br.keywords.uniform,br.keywords.storage],ko.access_mode=[br.keywords.read,br.keywords.write,br.keywords.read_write],ko.sampler_type=[br.keywords.sampler,br.keywords.sampler_comparison],ko.sampled_texture_type=[br.keywords.texture_1d,br.keywords.texture_2d,br.keywords.texture_2d_array,br.keywords.texture_3d,br.keywords.texture_cube,br.keywords.texture_cube_array],ko.multisampled_texture_type=[br.keywords.texture_multisampled_2d],ko.storage_texture_type=[br.keywords.texture_storage_1d,br.keywords.texture_storage_2d,br.keywords.texture_storage_2d_array,br.keywords.texture_storage_3d],ko.depth_texture_type=[br.keywords.texture_depth_2d,br.keywords.texture_depth_2d_array,br.keywords.texture_depth_cube,br.keywords.texture_depth_cube_array,br.keywords.texture_depth_multisampled_2d],ko.texture_external_type=[br.keywords.texture_external],ko.any_texture_type=[...br.sampled_texture_type,...br.multisampled_texture_type,...br.storage_texture_type,...br.depth_texture_type,...br.texture_external_type],ko.texel_format=[br.keywords.r8unorm,br.keywords.r8snorm,br.keywords.r8uint,br.keywords.r8sint,br.keywords.r16uint,br.keywords.r16sint,br.keywords.r16float,br.keywords.rg8unorm,br.keywords.rg8snorm,br.keywords.rg8uint,br.keywords.rg8sint,br.keywords.r32uint,br.keywords.r32sint,br.keywords.r32float,br.keywords.rg16uint,br.keywords.rg16sint,br.keywords.rg16float,br.keywords.rgba8unorm,br.keywords.rgba8unorm_srgb,br.keywords.rgba8snorm,br.keywords.rgba8uint,br.keywords.rgba8sint,br.keywords.bgra8unorm,br.keywords.bgra8unorm_srgb,br.keywords.rgb10a2unorm,br.keywords.rg11b10float,br.keywords.rg32uint,br.keywords.rg32sint,br.keywords.rg32float,br.keywords.rgba16uint,br.keywords.rgba16sint,br.keywords.rgba16float,br.keywords.rgba32uint,br.keywords.rgba32sint,br.keywords.rgba32float],ko.const_literal=[br.tokens.int_literal,br.tokens.uint_literal,br.tokens.decimal_float_literal,br.tokens.hex_float_literal,br.keywords.true,br.keywords.false],ko.literal_or_ident=[br.tokens.ident,br.tokens.int_literal,br.tokens.uint_literal,br.tokens.decimal_float_literal,br.tokens.hex_float_literal],ko.element_count_expression=[br.tokens.int_literal,br.tokens.uint_literal,br.tokens.ident],ko.template_types=[br.keywords.vec2,br.keywords.vec3,br.keywords.vec4,br.keywords.mat2x2,br.keywords.mat2x3,br.keywords.mat2x4,br.keywords.mat3x2,br.keywords.mat3x3,br.keywords.mat3x4,br.keywords.mat4x2,br.keywords.mat4x3,br.keywords.mat4x4,br.keywords.atomic,br.keywords.bitcast,...br.any_texture_type],ko.attribute_name=[br.tokens.ident,br.keywords.block],ko.assignment_operators=[br.tokens.equal,br.tokens.plus_equal,br.tokens.minus_equal,br.tokens.times_equal,br.tokens.division_equal,br.tokens.modulo_equal,br.tokens.and_equal,br.tokens.or_equal,br.tokens.xor_equal,br.tokens.shift_right_equal,br.tokens.shift_left_equal],ko.increment_operators=[br.tokens.plus_plus,br.tokens.minus_minus];class To{constructor(t,e,r){this.type=t,this.lexeme=e,this.line=r}toString(){return this.lexeme}isTemplateType(){return-1!=ko.template_types.indexOf(this.type)}isArrayType(){return this.type==ko.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Mo{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=t?t:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new To(ko.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if("\n"==t)return this._line++,!0;if(this._isWhitespace(t))return!0;if("/"==t){if("/"==this._peekAhead()){for(;"\n"!=t;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let e=1;for(;e>0;){if(this._isAtEnd())return!0;if(t=this._advance(),"\n"==t)this._line++;else if("*"==t){if("/"==this._peekAhead()&&(this._advance(),e--,0==e))return!0}else"/"==t&&"*"==this._peekAhead()&&(this._advance(),e++)}return!0}}let e=ko.none;for(;;){let r=this._findType(t);const o=this._peekAhead();if(">"==t&&(">"==o||"="==o)){let t=!1,e=this._tokens.length-1;for(let r=0;r<5&&e>=0;++r,--e)if(this._tokens[e].type===ko.tokens.less_than){e>0&&this._tokens[e-1].isArrayOrTemplateType()&&(t=!0);break}if(t)return this._addToken(r),!0}if(r===ko.none){let o=t,n=0;const i=2;for(let t=0;t<i;++t)if(o+=this._peekAhead(t),r=this._findType(o),r!==ko.none){n=t;break}if(r===ko.none)return e!==ko.none&&(this._current--,this._addToken(e),!0);t=o,this._current+=n+1}if(e=r,this._isAtEnd())break;t+=this._advance()}return e!==ko.none&&(this._addToken(e),!0)}_findType(t){for(const e in ko.keywords){const r=ko.keywords[e];if(this._match(t,r.rule))return r}for(const e in ko.tokens){const r=ko.tokens[e];if(this._match(t,r.rule))return r}return ko.none}_match(t,e){if("string"==typeof e){if(e==t)return!0}else{const r=e.exec(t);if(r&&0==r.index&&r[0]==t)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(t){return" "==t||"\t"==t||"\r"==t}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new To(t,e,this._line))}}class So{constructor(){this._tokens=[],this._current=0,this._context=new Mr}parse(t){this._initialize(t);let e=[];for(;!this._isAtEnd();){const t=this._global_decl_or_directive();if(!t)break;e.push(t)}return e}_initialize(t){if(t)if("string"==typeof t){const e=new Mo(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,e){return console.error(t,e),{token:t,message:e,toString:function(){return`${e}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ko.eof}_match(t){if(t instanceof bo)return!!this._check(t)&&(this._advance(),!0);for(let e=0,r=t.length;e<r;++e){const r=t[e];if(this._check(r))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),e)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){let r=e.type;return-1!=t.indexOf(r)}return e.type==t}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ko.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ko.keywords.alias)){const t=this._type_alias();return this._consume(ko.tokens.semicolon,"Expected ';'"),t}if(this._match(ko.keywords.enable)){const t=this._enable_directive();return this._consume(ko.tokens.semicolon,"Expected ';'"),t}const t=this._attribute();if(this._check(ko.keywords.var)){const e=this._global_variable_decl();return null!=e&&(e.attributes=t),this._consume(ko.tokens.semicolon,"Expected ';'."),e}if(this._check(ko.keywords.override)){const e=this._override_variable_decl();return null!=e&&(e.attributes=t),this._consume(ko.tokens.semicolon,"Expected ';'."),e}if(this._check(ko.keywords.let)){const e=this._global_let_decl();return null!=e&&(e.attributes=t),this._consume(ko.tokens.semicolon,"Expected ';'."),e}if(this._check(ko.keywords.const)){const e=this._global_const_decl();return null!=e&&(e.attributes=t),this._consume(ko.tokens.semicolon,"Expected ';'."),e}if(this._check(ko.keywords.struct)){const e=this._struct_decl();return null!=e&&(e.attributes=t),e}if(this._check(ko.keywords.fn)){const e=this._function_decl();return null!=e&&(e.attributes=t),e}return null}_function_decl(){if(!this._match(ko.keywords.fn))return null;const t=this._consume(ko.tokens.ident,"Expected function name.").toString();this._consume(ko.tokens.paren_left,"Expected '(' for function arguments.");const e=[];if(!this._check(ko.tokens.paren_right))do{if(this._check(ko.tokens.paren_right))break;const t=this._attribute(),r=this._consume(ko.tokens.ident,"Expected argument name.").toString();this._consume(ko.tokens.colon,"Expected ':' for argument type.");const o=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=o,e.push(new yo(r,n,t)))}while(this._match(ko.tokens.comma));this._consume(ko.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(ko.tokens.arrow)){const t=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=t)}const o=this._compound_statement();return new Ar(t,e,r,o)}_compound_statement(){const t=[];for(this._consume(ko.tokens.brace_left,"Expected '{' for block.");!this._check(ko.tokens.brace_right);){const e=this._statement();null!==e&&t.push(e)}return this._consume(ko.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(ko.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ko.keywords.if))return this._if_statement();if(this._check(ko.keywords.switch))return this._switch_statement();if(this._check(ko.keywords.loop))return this._loop_statement();if(this._check(ko.keywords.for))return this._for_statement();if(this._check(ko.keywords.while))return this._while_statement();if(this._check(ko.keywords.continuing))return this._continuing_statement();if(this._check(ko.keywords.static_assert))return this._static_assert_statement();if(this._check(ko.tokens.brace_left))return this._compound_statement();let t=null;return t=this._check(ko.keywords.return)?this._return_statement():this._check([ko.keywords.var,ko.keywords.let,ko.keywords.const])?this._variable_statement():this._match(ko.keywords.discard)?new Xr:this._match(ko.keywords.break)?new Yr:this._match(ko.keywords.continue)?new Hr:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=t&&this._consume(ko.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(ko.keywords.static_assert))return null;let t=this._optional_paren_expression();return new Ir(t)}_while_statement(){if(!this._match(ko.keywords.while))return null;let t=this._optional_paren_expression();const e=this._compound_statement();return new Pr(t,e)}_continuing_statement(){if(!this._match(ko.keywords.continuing))return null;const t=this._compound_statement();return new Or(t)}_for_statement(){if(!this._match(ko.keywords.for))return null;this._consume(ko.tokens.paren_left,"Expected '('.");const t=this._check(ko.tokens.semicolon)?null:this._for_init();this._consume(ko.tokens.semicolon,"Expected ';'.");const e=this._check(ko.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ko.tokens.semicolon,"Expected ';'.");const r=this._check(ko.tokens.paren_right)?null:this._for_increment();this._consume(ko.tokens.paren_right,"Expected ')'.");const o=this._compound_statement();return new Ur(t,e,r,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ko.keywords.var)){const t=this._variable_decl();if(null===t)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(ko.tokens.equal)&&(e=this._short_circuit_or_expression()),new zr(t.name,t.type,t.storage,t.access,e)}if(this._match(ko.keywords.let)){const t=this._consume(ko.tokens.ident,"Expected name for let.").toString();let e=null;if(this._match(ko.tokens.colon)){const t=this._attribute();e=this._type_decl(),null!=e&&(e.attributes=t)}this._consume(ko.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Vr(t,e,null,null,r)}if(this._match(ko.keywords.const)){const t=this._consume(ko.tokens.ident,"Expected name for const.").toString();let e=null;if(this._match(ko.tokens.colon)){const t=this._attribute();e=this._type_decl(),null!=e&&(e.attributes=t)}this._consume(ko.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Dr(t,e,null,null,r)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(null==e)return null;if(!this._check(ko.increment_operators))return this._current=t,null;const r=this._consume(ko.increment_operators,"Expected increment operator");return new qr(r.type===ko.tokens.plus_plus?xr.increment:xr.decrement,e)}_assignment_statement(){let t=null;if(this._check(ko.tokens.brace_right))return null;let e=this._match(ko.tokens.underscore);if(e||(t=this._unary_expression()),!e&&null==t)return null;const r=this._consume(ko.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new Rr(vr.parse(r.lexeme),t,o)}_func_call_statement(){if(!this._check(ko.tokens.ident))return null;const t=this._current,e=this._consume(ko.tokens.ident,"Expected function name."),r=this._argument_expression_list();return null===r?(this._current=t,null):new Gr(e.lexeme,r)}_loop_statement(){if(!this._match(ko.keywords.loop))return null;this._consume(ko.tokens.brace_left,"Expected '{' for loop.");const t=[];let e=this._statement();for(;null!==e;){if(Array.isArray(e))for(let r of e)t.push(r);else t.push(e);e=this._statement()}let r=null;return this._match(ko.keywords.continuing)&&(r=this._compound_statement()),this._consume(ko.tokens.brace_right,"Expected '}' for loop."),new Cr(t,r)}_switch_statement(){if(!this._match(ko.keywords.switch))return null;const t=this._optional_paren_expression();this._consume(ko.tokens.brace_left,"Expected '{' for switch.");const e=this._switch_body();if(null==e||0==e.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ko.tokens.brace_right,"Expected '}' for switch."),new jr(t,e)}_switch_body(){const t=[];if(this._match(ko.keywords.case)){const e=this._case_selectors();this._match(ko.tokens.colon),this._consume(ko.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(ko.tokens.brace_right,"Exected '}' for switch case."),t.push(new _o(e,r))}if(this._match(ko.keywords.default)){this._match(ko.tokens.colon),this._consume(ko.tokens.brace_left,"Exected '{' for switch default.");const e=this._case_body();this._consume(ko.tokens.brace_right,"Exected '}' for switch default."),t.push(new go(e))}if(this._check([ko.keywords.default,ko.keywords.case])){const e=this._switch_body();t.push(e[0])}return t}_case_selectors(){var t,e,r,o;const n=[null!==(e=null===(t=this._shift_expression())||void 0===t?void 0:t.evaluate(this._context).toString())&&void 0!==e?e:""];for(;this._match(ko.tokens.comma);)n.push(null!==(o=null===(r=this._shift_expression())||void 0===r?void 0:r.evaluate(this._context).toString())&&void 0!==o?o:"");return n}_case_body(){if(this._match(ko.keywords.fallthrough))return this._consume(ko.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(null==t)return[];t instanceof Array||(t=[t]);const e=this._case_body();return 0==e.length?t:[...t,e[0]]}_if_statement(){if(!this._match(ko.keywords.if))return null;const t=this._optional_paren_expression(),e=this._compound_statement();let r=[];this._match_elseif()&&(r=this._elseif_statement(r));let o=null;return this._match(ko.keywords.else)&&(o=this._compound_statement()),new Lr(t,e,r,o)}_match_elseif(){return this._tokens[this._current].type===ko.keywords.else&&this._tokens[this._current+1].type===ko.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),r=this._compound_statement();return t.push(new wo(e,r)),this._match_elseif()&&this._elseif_statement(t),t}_return_statement(){if(!this._match(ko.keywords.return))return null;const t=this._short_circuit_or_expression();return new Fr(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(ko.tokens.or_or);)t=new mo(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(ko.tokens.and_and);)t=new mo(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(ko.tokens.or);)t=new mo(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(ko.tokens.xor);)t=new mo(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(ko.tokens.and);)t=new mo(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([ko.tokens.equal_equal,ko.tokens.not_equal])?new mo(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([ko.tokens.less_than,ko.tokens.greater_than,ko.tokens.less_than_equal,ko.tokens.greater_than_equal]);)t=new mo(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([ko.tokens.shift_left,ko.tokens.shift_right]);)t=new mo(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([ko.tokens.plus,ko.tokens.minus]);)t=new mo(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([ko.tokens.star,ko.tokens.forward_slash,ko.tokens.modulo]);)t=new mo(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([ko.tokens.minus,ko.tokens.bang,ko.tokens.tilde,ko.tokens.star,ko.tokens.and])?new ho(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(ko.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(ko.tokens.bracket_right,"Expected ']'.");const e=this._postfix_expression();return e&&(t.postfix=e),t}if(this._match(ko.tokens.period)){const t=this._consume(ko.tokens.ident,"Expected member name."),e=this._postfix_expression(),r=new ro(t.lexeme);return e&&(r.postfix=e),r}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(ko.tokens.ident)){const t=this._previous().toString();if(this._check(ko.tokens.paren_left)){const e=this._argument_expression_list(),r=this._getStruct(t);return null!=r?new oo(r,e):new no(t,e)}if(this._context.constants.has(t)){const e=this._context.constants.get(t);return new so(t,e.value)}return new io(t)}if(this._match(ko.const_literal))return new ao(parseFloat(this._previous().toString()));if(this._check(ko.tokens.paren_left))return this._paren_expression();if(this._match(ko.keywords.bitcast)){this._consume(ko.tokens.less_than,"Expected '<'.");const t=this._type_decl();this._consume(ko.tokens.greater_than,"Expected '>'.");const e=this._paren_expression();return new uo(t,e)}const t=this._type_decl(),e=this._argument_expression_list();return new co(t,e)}_argument_expression_list(){if(!this._match(ko.tokens.paren_left))return null;const t=[];do{if(this._check(ko.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(ko.tokens.comma));return this._consume(ko.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(ko.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(ko.tokens.paren_right),new lo([t])}_paren_expression(){this._consume(ko.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(ko.tokens.paren_right,"Expected ')'."),new lo([t])}_struct_decl(){if(!this._match(ko.keywords.struct))return null;const t=this._consume(ko.tokens.ident,"Expected name for struct.").toString();this._consume(ko.tokens.brace_left,"Expected '{' for struct body.");const e=[];for(;!this._check(ko.tokens.brace_right);){const t=this._attribute(),r=this._consume(ko.tokens.ident,"Expected variable name.").toString();this._consume(ko.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=o),this._check(ko.tokens.brace_right)?this._match(ko.tokens.comma):this._consume(ko.tokens.comma,"Expected ',' for struct member."),e.push(new xo(r,n,t))}this._consume(ko.tokens.brace_right,"Expected '}' after struct body.");const r=new Qr(t,e);return this._context.structs.set(t,r),r}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(ko.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(ko.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(ko.keywords.const))return null;const t=this._consume(ko.tokens.ident,"Expected variable name");let e=null;if(this._match(ko.tokens.colon)){const t=this._attribute();e=this._type_decl(),null!=e&&(e.attributes=t)}let r=null;if(this._match(ko.tokens.equal)){const t=this._short_circuit_or_expression();if(t instanceof oo)r=t;else if(t instanceof so&&t.initializer instanceof oo)r=t.initializer;else try{const e=t.evaluate(this._context);r=new ao(e)}catch(e){r=t}}const o=new Dr(t.toString(),e,"","",r);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(ko.keywords.let))return null;const t=this._consume(ko.tokens.ident,"Expected variable name");let e=null;if(this._match(ko.tokens.colon)){const t=this._attribute();e=this._type_decl(),null!=e&&(e.attributes=t)}let r=null;return this._match(ko.tokens.equal)&&(r=this._const_expression()),new Vr(t.toString(),e,"","",r)}_const_expression(){if(this._match(ko.const_literal))return new ro(this._previous().toString());const t=this._type_decl();this._consume(ko.tokens.paren_left,"Expected '('.");let e=[];for(;!this._check(ko.tokens.paren_right)&&(e.push(this._const_expression()),this._check(ko.tokens.comma));)this._advance();return this._consume(ko.tokens.paren_right,"Expected ')'."),new oo(t,e)}_variable_decl(){if(!this._match(ko.keywords.var))return null;let t="",e="";this._match(ko.tokens.less_than)&&(t=this._consume(ko.storage_class,"Expected storage_class.").toString(),this._match(ko.tokens.comma)&&(e=this._consume(ko.access_mode,"Expected access_mode.").toString()),this._consume(ko.tokens.greater_than,"Expected '>'."));const r=this._consume(ko.tokens.ident,"Expected variable name");let o=null;if(this._match(ko.tokens.colon)){const t=this._attribute();o=this._type_decl(),null!=o&&(o.attributes=t)}return new zr(r.toString(),o,t,e,null)}_override_decl(){if(!this._match(ko.keywords.override))return null;const t=this._consume(ko.tokens.ident,"Expected variable name");let e=null;if(this._match(ko.tokens.colon)){const t=this._attribute();e=this._type_decl(),null!=e&&(e.attributes=t)}return new Nr(t.toString(),e,null)}_enable_directive(){const t=this._consume(ko.tokens.ident,"identity expected.");return new Br(t.toString())}_type_alias(){const t=this._consume(ko.tokens.ident,"identity expected.");this._consume(ko.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(null===e)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const r=new $r(t.toString(),e);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([ko.tokens.ident,...ko.texel_format,ko.keywords.bool,ko.keywords.f32,ko.keywords.i32,ko.keywords.u32])){const t=this._advance(),e=t.toString();return this._context.structs.has(e)?this._context.structs.get(e):this._context.aliases.has(e)?this._context.aliases.get(e).type:new Wr(t.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(ko.template_types)){let t=this._advance().toString(),e=null,r=null;return this._match(ko.tokens.less_than)&&(e=this._type_decl(),r=null,this._match(ko.tokens.comma)&&(r=this._consume(ko.access_mode,"Expected access_mode for pointer").toString()),this._consume(ko.tokens.greater_than,"Expected '>' for type.")),new Zr(t,e,r)}if(this._match(ko.keywords.ptr)){let t=this._previous().toString();this._consume(ko.tokens.less_than,"Expected '<' for pointer.");const e=this._consume(ko.storage_class,"Expected storage_class for pointer");this._consume(ko.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let o=null;return this._match(ko.tokens.comma)&&(o=this._consume(ko.access_mode,"Expected access_mode for pointer").toString()),this._consume(ko.tokens.greater_than,"Expected '>' for pointer."),new Jr(t,e.toString(),r,o)}const e=this._attribute();if(this._match(ko.keywords.array)){let t=null,r=-1;const o=this._previous();if(this._match(ko.tokens.less_than)){t=this._type_decl(),this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let e="";this._match(ko.tokens.comma)&&(e=this._shift_expression().evaluate(this._context).toString()),this._consume(ko.tokens.greater_than,"Expected '>' for array."),r=e?parseInt(e):0}return new Kr(o.toString(),e,t,r)}return null}_texture_sampler_types(){if(this._match(ko.sampler_type))return new to(this._previous().toString(),null,null);if(this._match(ko.depth_texture_type))return new to(this._previous().toString(),null,null);if(this._match(ko.sampled_texture_type)||this._match(ko.multisampled_texture_type)){const t=this._previous();this._consume(ko.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(ko.tokens.greater_than,"Expected '>' for sampler type."),new to(t.toString(),e,null)}if(this._match(ko.storage_texture_type)){const t=this._previous();this._consume(ko.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(ko.texel_format,"Invalid texel format.").toString();this._consume(ko.tokens.comma,"Expected ',' after texel format.");const r=this._consume(ko.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ko.tokens.greater_than,"Expected '>' for sampler type."),new to(t.toString(),e,r)}return null}_attribute(){let t=[];for(;this._match(ko.tokens.attr);){const e=this._consume(ko.attribute_name,"Expected attribute name"),r=new vo(e.toString(),null);if(this._match(ko.tokens.paren_left)){if(r.value=this._consume(ko.literal_or_ident,"Expected attribute value").toString(),this._check(ko.tokens.comma)){this._advance();do{const t=this._consume(ko.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(t)}while(this._match(ko.tokens.comma))}this._consume(ko.tokens.paren_right,"Expected ')'")}t.push(r)}for(;this._match(ko.tokens.attr_left);){if(!this._check(ko.tokens.attr_right))do{const e=this._consume(ko.attribute_name,"Expected attribute name"),r=new vo(e.toString(),null);if(this._match(ko.tokens.paren_left)){if(r.value=[this._consume(ko.literal_or_ident,"Expected attribute value").toString()],this._check(ko.tokens.comma)){this._advance();do{const t=this._consume(ko.literal_or_ident,"Expected attribute value").toString();r.value.push(t)}while(this._match(ko.tokens.comma))}this._consume(ko.tokens.paren_right,"Expected ')'")}t.push(r)}while(this._match(ko.tokens.comma));this._consume(ko.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==t.length?null:t}}class Eo{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Ao{constructor(t,e,r){this.name=t,this.type=e,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Io extends Eo{constructor(t,e){super(t,e),this.members=[],this.align=0}get isStruct(){return!0}}class Po extends Eo{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class Oo extends Eo{constructor(t,e,r,o){super(t,r),this.format=e,this.access=o}get isTemplate(){return!0}}!function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"}(Tr||(Tr={}));class Uo{constructor(t,e,r,o,n,i,s){this.name=t,this.type=e,this.group=r,this.binding=o,this.attributes=n,this.resourceType=i,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class zo{constructor(t,e){this.name=t,this.type=e}}class No{constructor(t,e){this.align=t,this.size=e}}class Vo{constructor(t,e,r,o){this.name=t,this.type=e,this.locationType=r,this.location=o,this.interpolation=null}}class Do{constructor(t,e,r,o){this.name=t,this.type=e,this.locationType=r,this.location=o}}class qo{constructor(t,e=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=t,this.stage=e}}class Ro{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Go{constructor(t,e,r,o){this.name=t,this.type=e,this.attributes=r,this.id=o}}class Co{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Ro,this._types=new Map,t&&this.update(t)}_isStorageTexture(t){return"texture_storage_1d"==t.name||"texture_storage_2d"==t.name||"texture_storage_2d_array"==t.name||"texture_storage_3d"==t.name}update(t){const e=(new So).parse(t);for(const t of e)if(t instanceof Qr){const e=this._getTypeInfo(t,null);e instanceof Io&&this.structs.push(e)}else if(t instanceof $r)this.aliases.push(this._getAliasInfo(t));else if(t instanceof Nr){const e=t,r=this._getAttributeNum(e.attributes,"id",0),o=null!=e.type?this._getTypeInfo(e.type,e.attributes):null;this.overrides.push(new Go(e.name,o,e.attributes,r))}else if(this._isUniformVar(t)){const e=t,r=this._getAttributeNum(e.attributes,"group",0),o=this._getAttributeNum(e.attributes,"binding",0),n=this._getTypeInfo(e.type,e.attributes),i=new Uo(e.name,n,r,o,e.attributes,Tr.Uniform,e.access);this.uniforms.push(i)}else if(this._isStorageVar(t)){const e=t,r=this._getAttributeNum(e.attributes,"group",0),o=this._getAttributeNum(e.attributes,"binding",0),n=this._getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(n),s=new Uo(e.name,n,r,o,e.attributes,i?Tr.StorageTexture:Tr.Storage,e.access);this.storage.push(s)}else if(this._isTextureVar(t)){const e=t,r=this._getAttributeNum(e.attributes,"group",0),o=this._getAttributeNum(e.attributes,"binding",0),n=this._getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(n),s=new Uo(e.name,n,r,o,e.attributes,i?Tr.StorageTexture:Tr.Texture,e.access);i?this.storage.push(s):this.textures.push(s)}else if(this._isSamplerVar(t)){const e=t,r=this._getAttributeNum(e.attributes,"group",0),o=this._getAttributeNum(e.attributes,"binding",0),n=this._getTypeInfo(e.type,e.attributes),i=new Uo(e.name,n,r,o,e.attributes,Tr.Sampler,e.access);this.samplers.push(i)}else if(t instanceof Ar){const e=this._getAttribute(t,"vertex"),r=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),n=e||r||o;if(n){const e=new qo(t.name,n.name);e.inputs=this._getInputs(t.args),e.outputs=this._getOutputs(t.returnType),this.entry[n.name].push(e)}}}getBindGroups(){const t=[];function e(e,r){e>=t.length&&(t.length=e+1),void 0===t[e]&&(t[e]=[]),r>=t[e].length&&(t[e].length=r+1)}for(const r of this.uniforms)e(r.group,r.binding),t[r.group][r.binding]=r;for(const r of this.storage)e(r.group,r.binding),t[r.group][r.binding]=r;for(const r of this.textures)e(r.group,r.binding),t[r.group][r.binding]=r;for(const r of this.samplers)e(r.group,r.binding),t[r.group][r.binding]=r;return t}_getOutputs(t,e=void 0){if(void 0===e&&(e=[]),t instanceof Qr)this._getStructOutputs(t,e);else{const r=this._getOutputInfo(t);null!==r&&e.push(r)}return e}_getStructOutputs(t,e){for(const r of t.members)if(r.type instanceof Qr)this._getStructOutputs(r.type,e);else{const t=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(null!==t){const o=this._getTypeInfo(r.type,r.type.attributes),n=this._parseInt(t.value),i=new Do(r.name,o,t.name,n);e.push(i)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(null!==e){const r=this._getTypeInfo(t,t.attributes),o=this._parseInt(e.value);return new Do("",r,e.name,o)}return null}_getInputs(t,e=void 0){void 0===e&&(e=[]);for(const r of t)if(r.type instanceof Qr)this._getStructInputs(r.type,e);else{const t=this._getInputInfo(r);null!==t&&e.push(t)}return e}_getStructInputs(t,e){for(const r of t.members)if(r.type instanceof Qr)this._getStructInputs(r.type,e);else{const t=this._getInputInfo(r);null!==t&&e.push(t)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(null!==e){const r=this._getAttribute(t,"interpolation"),o=this._getTypeInfo(t.type,t.attributes),n=this._parseInt(e.value),i=new Vo(t.name,o,e.name,n);return null!==r&&(i.interpolation=this._parseString(r.value)),i}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new zo(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,e){if(this._types.has(t))return this._types.get(t);if(t instanceof Kr){const r=t,o=this._getTypeInfo(r.format,r.attributes),n=new Po(r.name,e);return n.format=o,n.count=r.count,this._types.set(t,n),this._updateTypeInfo(n),n}if(t instanceof Qr){const r=t,o=new Io(r.name,e);for(const t of r.members){const e=this._getTypeInfo(t.type,t.attributes);o.members.push(new Ao(t.name,e,t.attributes))}return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof to){const r=t,o=r.format instanceof Wr,n=r.format?o?this._getTypeInfo(r.format,null):new Eo(r.format,null):null,i=new Oo(r.name,n,e,r.access);return this._types.set(t,i),this._updateTypeInfo(i),i}if(t instanceof Zr){const r=t,o=r.format?this._getTypeInfo(r.format,null):null,n=new Oo(r.name,o,e,r.access);return this._types.set(t,n),this._updateTypeInfo(n),n}const r=new Eo(t.name,e);return this._types.set(t,r),this._updateTypeInfo(r),r}_updateTypeInfo(t){var e,r;const o=this._getTypeSize(t);if(t.size=null!==(e=null==o?void 0:o.size)&&void 0!==e?e:0,t instanceof Po){const e=this._getTypeSize(t.format);t.stride=null!==(r=null==e?void 0:e.size)&&void 0!==r?r:0,this._updateTypeInfo(t.format)}t instanceof Io&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let r=0,o=0,n=0,i=0;for(let s=0,a=t.members.length;s<a;++s){const a=t.members[s],u=this._getTypeSize(a);if(!u)continue;null!==(e=this._getAlias(a.type.name))&&void 0!==e||a.type;const c=u.align,l=u.size;r=this._roundUp(c,r+o),o=l,n=r,i=Math.max(i,c),a.offset=r,a.size=l,this._updateTypeInfo(a.type)}t.size=this._roundUp(i,n+o),t.align=i}_getTypeSize(t){var e;if(null==t)return null;const r=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof Ao&&(t=t.type),t instanceof Eo){const e=this._getAlias(t.name);null!==e&&(t=e)}{const e=Co._typeInfo[t.name];if(void 0!==e){const n="f16"===t.format?2:1;return new No(Math.max(o,e.align/n),Math.max(r,e.size/n))}}{const e=Co._typeInfo[t.name.substring(0,t.name.length-1)];if(e){const n="h"===t.name[t.name.length-1]?2:1;return new No(Math.max(o,e.align/n),Math.max(r,e.size/n))}}if(t instanceof Po){let n=t,i=8,s=8;const a=this._getTypeSize(n.format);return null!==a&&(s=a.size,i=a.align),s=n.count*this._getAttributeNum(null!==(e=null==t?void 0:t.attributes)&&void 0!==e?e:null,"stride",this._roundUp(i,s)),r&&(s=r),new No(Math.max(o,i),Math.max(r,s))}if(t instanceof Io){let e=0,n=0,i=0,s=0,a=0;for(const r of t.members){const t=this._getTypeSize(r.type);null!==t&&(e=Math.max(t.align,e),i=this._roundUp(t.align,i+s),s=t.size,a=i)}return n=this._roundUp(e,a+s),new No(Math.max(o,e),Math.max(r,n))}return null}_isUniformVar(t){return t instanceof zr&&"uniform"==t.storage}_isStorageVar(t){return t instanceof zr&&"storage"==t.storage}_isTextureVar(t){return t instanceof zr&&null!==t.type&&-1!=Co._textureTypes.indexOf(t.type.name)}_isSamplerVar(t){return t instanceof zr&&null!==t.type&&-1!=Co._samplerTypes.indexOf(t.type.name)}_getAttribute(t,e){const r=t;if(!r||!r.attributes)return null;const o=r.attributes;for(let t of o)if(t.name==e)return t;return null}_getAttributeNum(t,e,r){if(null===t)return r;for(let o of t)if(o.name==e){let t=null!==o&&null!==o.value?o.value:r;return t instanceof Array&&(t=t[0]),"number"==typeof t?t:"string"==typeof t?parseInt(t):r}return r}_roundUp(t,e){return Math.ceil(e/t)*t}}function jo(t,e){const r=function(t){return Array.isArray(t)||fr(t)?[...t,1,1].slice(0,3):function(t){return[t.width,t.height||1,t.depthOrArrayLayers||1]}(t)}(t),o=Math.max(...r.slice(0,"3d"===e?3:2));return 1+Math.log2(o)|0}Co._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Co._textureTypes=ko.any_texture_type.map((t=>t.name)),Co._samplerTypes=ko.sampler_type.map((t=>t.name));const Lo=new WeakMap,Fo=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]);function Bo(t){return fr(t)||Array.isArray(t)||function(t){const e=t;return fr(e.data)||Array.isArray(e.data)}(t)}function $o(t){switch(t){case"1d":return"1d";case"3d":return"3d";default:return"2d"}}new Map([...Fo.entries()].map((([t,{formats:[e,r]}])=>[[e,t],[r,t]])).flat());const Xo={"8snorm":Int8Array,"8unorm":Uint8Array,"8sint":Int8Array,"8uint":Uint8Array,"16snorm":Int16Array,"16unorm":Uint16Array,"16sint":Int16Array,"16uint":Uint16Array,"32snorm":Int32Array,"32unorm":Uint32Array,"32sint":Int32Array,"32uint":Uint32Array,"16float":Uint16Array,"32float":Float32Array},Yo=/([a-z]+)(\d+)([a-z]+)/;function Ho(t){const[,e,r,o]=Yo.exec(t),n=e.length,i=parseInt(r)/8;return{channels:e,numChannels:n,bytesPerChannel:i,bytesPerElement:n*i,Type:Xo[`${r}${o}`]}}function Wo(t,e,r,o={}){r.forEach(((r,n)=>{const i=[0,0,n+(o.baseArrayLayer||0)];if(Bo(r))!function(t,e,r,o){const n=function(t,e){if(fr(t))return t;const{Type:r}=Ho(e);return new r(t)}(r.data||r,e.format),i=function(t,e){return[t.width,t.height,t.depthOrArrayLayers].map((t=>Math.max(1,Math.floor(t/1))))}(e),{bytesPerElement:s}=Ho(e.format),a=o.origin||[0,0,0];t.queue.writeTexture({texture:e,origin:a},n,{bytesPerRow:s*i[0],rowsPerImage:i[1]},i)}(t,e,r,{origin:i});else{const n=r,{flipY:s,premultipliedAlpha:a,colorSpace:u}=o;t.queue.copyExternalImageToTexture({source:n,flipY:s},{texture:e,premultipliedAlpha:a,colorSpace:u,origin:i},Qo(n,o))}})),e.mipLevelCount>1&&function(t,e){let r=Lo.get(t);r||(r={pipelineByFormat:{},moduleByView:{}},Lo.set(t,r));let{sampler:o}=r;const{pipelineByFormat:n,moduleByView:i}=r,s=function(t){switch(t.dimension){case"1d":return"1d";case"3d":return"3d";default:return t.depthOrArrayLayers>1?"2d-array":"2d"}}(e);let a=i[s];a||(a=t.createShaderModule({label:`mip level generation for ${s}`,code:"\n        struct VSOutput {\n          @builtin(position) position: vec4f,\n          @location(0) texcoord: vec2f,\n        };\n\n        @vertex fn vs(\n          @builtin(vertex_index) vertexIndex : u32\n        ) -> VSOutput {\n          var pos = array<vec2f, 3>(\n            vec2f(-1.0, -1.0),\n            vec2f(-1.0,  3.0),\n            vec2f( 3.0, -1.0),\n          );\n\n          var vsOutput: VSOutput;\n          let xy = pos[vertexIndex];\n          vsOutput.position = vec4f(xy, 0.0, 1.0);\n          vsOutput.texcoord = xy * vec2f(0.5, -0.5) + vec2f(0.5);\n          return vsOutput;\n        }\n\n        @group(0) @binding(0) var ourSampler: sampler;\n        @group(0) @binding(1) var ourTexture: texture_2d<f32>;\n\n        @fragment fn fs(fsInput: VSOutput) -> @location(0) vec4f {\n          return textureSample(ourTexture, ourSampler, fsInput.texcoord);\n        }\n      "}),i[s]=a),o||(o=t.createSampler({minFilter:"linear"}),r.sampler=o);const u=`${e.format}`;n[u]||(n[u]=t.createRenderPipeline({label:`mip level generator pipeline for ${s}`,layout:"auto",vertex:{module:a,entryPoint:"vs"},fragment:{module:a,entryPoint:"fs",targets:[{format:e.format}]}}));const c=n[u],l=t.createCommandEncoder({label:"mip gen encoder"});for(let r=1;r<e.mipLevelCount;++r)for(let n=0;n<e.depthOrArrayLayers;++n){const i=t.createBindGroup({layout:c.getBindGroupLayout(0),entries:[{binding:0,resource:o},{binding:1,resource:e.createView({dimension:"2d",baseMipLevel:r-1,mipLevelCount:1,baseArrayLayer:n,arrayLayerCount:1})}]}),s={label:"mip gen renderPass",colorAttachments:[{view:e.createView({baseMipLevel:r,mipLevelCount:1,baseArrayLayer:n,arrayLayerCount:1}),loadOp:"clear",storeOp:"store"}]},a=l.beginRenderPass(s);a.setPipeline(c),a.setBindGroup(0,i),a.draw(3),a.end()}const p=l.finish();t.queue.submit([p])}(t,e)}function Qo(t,e){if(t instanceof HTMLVideoElement)return[t.videoWidth,t.videoHeight,1];{const r=t,{width:o,height:n}=r;if(o>0&&n>0&&!Bo(t))return[o,n,1];const i=e.format||"rgba8unorm",{bytesPerElement:s,bytesPerChannel:a}=Ho(i),u=fr(t)||Array.isArray(t)?t:t.data;return function(t,e,r,o="2d"){if(r%1!=0)throw new Error("can't guess dimensions");if(t||e){if(e){if(!t&&(t=r/e)%1)throw new Error("can't guess dimensions")}else if((e=r/t)%1)throw new Error("can't guess dimensions")}else{const n=Math.sqrt(r/("cube"===o?6:1));n%1==0?(t=n,e=n):(t=r,e=1)}const n=r/t/e;if(n%1)throw new Error("can't guess dimensions");return[t,e,n]}(o,n,(fr(u)?u.byteLength:u.length*a)/s)}}async function Zo(t,e,r={}){const o=await Promise.all(e.map((t=>async function(t,e={}){const r=await fetch(t),o=await r.blob(),n={...e,...void 0!==e.colorSpaceConversion&&{colorSpaceConversion:"none"}};return await createImageBitmap(o,n)}(t))));return function(t,e,r={}){const o=Qo(e[0],r);o[2]=o[2]>1?o[2]:e.length;const n=t.createTexture({dimension:$o(r.dimension),format:r.format||"rgba8unorm",mipLevelCount:r.mipLevelCount?r.mipLevelCount:r.mips?jo(o):1,size:o,usage:(r.usage??0)|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return Wo(t,n,e,r),n}(t,o,r)}async function Jo(t,e,r={}){return Zo(t,[e],r)}const Ko=async(t,e,r,o)=>{const[n,i,s]=r,a=t.createTexture({size:{width:n,height:i,depthOrArrayLayers:s},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC,dimension:"3d",label:o}),u=t.createCommandEncoder();for(let r=0;r<s;r++)try{const o=await Jo(t,e[r],{usage:GPUTextureUsage.COPY_SRC});u.copyTextureToTexture({texture:o,mipLevel:0,origin:{x:0,y:0,z:0}},{texture:a,mipLevel:0,origin:{x:0,y:0,z:r}},{width:a.width,height:a.height,depthOrArrayLayers:1})}catch(t){console.log(`Error creating texture from image at ${e[r]}: ${t}`)}return t.queue.submit([u.finish()]),a},tn=async()=>{const t=on.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm"}},{binding:3,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"unfilterable-float"}}]}),e=on.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float",viewDimension:"3d"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.COMPUTE,sampler:{type:"non-filtering"}},{binding:6,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm"}},{binding:7,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),r=on.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),o=on.createComputePipeline({layout:on.createPipelineLayout({bindGroupLayouts:[e,t]}),compute:{module:on.createShaderModule({code:`\n          const VOXEL_OBJECT_COUNT = ${rn.objectCount};\n          // Constants\r\nconst infinity : f32 = 99999999.0;\r\n\r\n// Utility functions\r\nfn degreesToRadians(degrees : f32) -> f32 {\r\n    return degrees * (3.1415926535897932385 / 180.0);\r\n}\r\n\r\nfn unitVector(v : vec3<f32>) -> vec3<f32> {\r\n    return v / length(v);\r\n}\r\n\r\nfn lengthSquared(v : vec3<f32>) -> f32 {\r\n    return v.x * v.x + v.y * v.y + v.z * v.z;\r\n}\r\n\r\nfn random(co : vec2<f32>) -> f32 {\r\n    return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfn randomMinMax(co : vec2<f32>, min : f32, max : f32) -> f32 {\r\n    return min + (max - min) * random(co);\r\n}\r\n\r\nfn randomFloat3(co : vec2<f32>) -> vec3<f32> {\r\n    return vec3<f32>(random(co), random(co * 2.0), random(co * 3.0));\r\n}\r\n\r\nfn randomFloat3MinMax(co : vec2<f32>, min : f32, max : f32) -> vec3<f32> {\r\n    return vec3<f32>(randomMinMax(co, min, max), randomMinMax(co * 2.0, min, max), randomMinMax(co * 3.0, min, max));\r\n}\r\n\r\nfn randomInUnitSphere(co : vec2<f32>) -> vec3<f32> {\r\n    var p : vec3<f32> = randomFloat3MinMax(co, -1.0, 1.0);\r\n    while (lengthSquared(p) < 1.0) {\r\n        p = randomFloat3MinMax(co, -1.0, 1.0);\r\n    }\r\n    return p;\r\n}\r\n\r\nfn randomInUnitDisk(seed : vec2<f32>) -> vec2<f32> {\r\n    let r = sqrt(random(seed));\r\n    let theta = 2.0 * 3.14159265359 * random(vec2<f32>(seed.y, seed.x));\r\n    return vec2<f32>(cos(theta), sin(theta)) * r;\r\n}\r\n\r\nfn reflect(v : vec3<f32>, n : vec3<f32>) -> vec3<f32> {\r\n    return v - 2.0 * dot(v, n) * n;\r\n}\r\n\r\nfn randomUnitVector(co : vec2<f32>) -> vec3<f32> {\r\n    return unitVector(randomInUnitSphere(co));\r\n}\r\n\r\nfn nearZero(e : vec3<f32>) -> bool {\r\n    const s : f32 = 1e-8;\r\n    return (abs(e.x) < s) && (abs(e.y) < s) && (abs(e.z) < s);\r\n}\r\n\r\nfn randomInHemisphere(co : vec2<f32>, normal : vec3<f32>) -> vec3<f32> {\r\n    let inUnitSphere = randomUnitVector(co);\r\n    if (dot(inUnitSphere, normal) > 0.0) {\r\n        return inUnitSphere;\r\n    }\r\n    return -inUnitSphere;\r\n}\r\n\r\n// Function to perturb the normal vector within the hemisphere\r\nfn perturbDirection(normal: vec3<f32>, scatterAmount: f32, co: vec2<f32>) -> vec3<f32> {\r\n    // Generate a random vector in a hemisphere\r\n    let hemisphereVector : vec3<f32> = randomInHemisphere(co, normal);\r\n\r\n    // Combine the perturbation with the original normal\r\n    let perturbedDir : vec3<f32> = normalize(normal + scatterAmount * hemisphereVector);\r\n\r\n    return perturbedDir;\r\n}\n          ${s}\n          ${u}\n          ${a}\n          @group(0) @binding(0) var<uniform> resolution : vec2<u32>;\r\n@group(0) @binding(1) var voxels : texture_3d<f32>;\r\n@group(0) @binding(2) var<uniform> frustumCornerDirections : FrustumCornerDirections;\r\n@group(0) @binding(3) var<uniform> cameraPosition : vec3<f32>;\r\n@group(0) @binding(4) var<uniform> voxelObjects : array<VoxelObject, VOXEL_OBJECT_COUNT>; // TODO: dynamic amount of these using string interpolation\r\n@group(0) @binding(5) var voxelsSampler : sampler;\r\n@group(0) @binding(6) var diffuseStore : texture_storage_2d<rgba8unorm, write>;\r\n@group(0) @binding(7) var<uniform> time : f32;\r\n\r\n// g-buffer\r\n@group(1) @binding(0) var normalTex : texture_2d<f32>;\r\n@group(1) @binding(1) var albedoTex : texture_2d<f32>;\r\n@group(1) @binding(2) var outputTex : texture_storage_2d<rgba8unorm, write>;\r\n@group(1) @binding(3) var depthTex : texture_2d<f32>;\r\n\r\n\r\nfn reconstructPosition(cameraPosition: vec3<f32>, rayDirection: vec3<f32>, depth: f32) -> vec3<f32> {\r\n  return cameraPosition + rayDirection * depth;\r\n}\r\n\r\nconst PI = 3.1415926535897932384626433832795;\r\n\r\n// Function to compute Lambertian diffuse reflection\r\nfn lambertianReflectance(normal: vec3<f32>, co: vec2<f32>) -> f32 {\r\n    // Generate a random direction in the hemisphere\r\n    let randomDir : vec3<f32> = randomInHemisphere(co, normal);\r\n\r\n    // Lambertian reflectance model\r\n    let cosTheta = dot(randomDir, normal);\r\n    let lambertianTerm = max(cosTheta, 0.0) / PI;\r\n\r\n    return lambertianTerm;\r\n}\r\n\r\noverride reflectance: f32 = 0.8;\r\n\r\n// TODO: raymarch from surface instead of from camera\r\n@compute @workgroup_size(8, 8, 1)\r\nfn main(\r\n  @builtin(global_invocation_id) GlobalInvocationID : vec3<u32>\r\n)\r\n{\r\n  var uv = vec2<f32>(GlobalInvocationID.xy) / vec2<f32>(resolution);\r\n  uv = vec2(uv.x, 1.0 - uv.y);\r\n  let bounces = 2;\r\n  var pixel = uv * vec2<f32>(resolution);\r\n\r\n  var rayDirection = calculateRayDirection(uv,frustumCornerDirections);\r\n  let normalSample = textureLoad(normalTex, GlobalInvocationID.xy, 0).rgb;\r\n  let depthSample = textureLoad(depthTex, GlobalInvocationID.xy, 0).r;\r\n  let worldPos = reconstructPosition(cameraPosition, rayDirection, depthSample) + normalSample * EPSILON; // EPSILON accounts for floating point errors\r\n  var averageRayColour = vec3(0.0);\r\n  var skyColour = vec3(1.0);\r\n\r\n  rayDirection = randomInHemisphere(uv, normalSample);\r\n  var rayColour = skyColour;\r\n  var rayOrigin = worldPos;\r\n\r\n  for(var bounce = 0; bounce < bounces; bounce++){\r\n    let rayMarchResult = rayMarch(0, rayOrigin, rayDirection, voxelObjects, voxelsSampler);\r\n    let isValidHit = rayMarchResult.hit && distance(rayMarchResult.worldPos, rayOrigin) > EPSILON;\r\n    if(!isValidHit){\r\n      var unitDirection = unitVector(rayDirection);\r\n      var attenuation = reflectance * (unitDirection.y + 1.0);\r\n      rayColour = vec3(1.0-attenuation) + attenuation * skyColour;\r\n      break;\r\n    }\r\n    rayDirection = randomInHemisphere(uv, rayMarchResult.normal);\r\n    rayOrigin = rayMarchResult.worldPos;\r\n    rayColour = rayColour * (rayMarchResult.colour * reflectance);\r\n  }\r\n\r\n  textureStore(\r\n      diffuseStore,\r\n      GlobalInvocationID.xy,\r\n      vec4(rayColour, 1.0),\r\n    );\r\n}\r\n\n      `}),entryPoint:"main"}}),n=on.createComputePipeline({layout:on.createPipelineLayout({bindGroupLayouts:[r,t]}),compute:{module:on.createShaderModule({code:"@group(0) @binding(0) var<uniform> resolution : vec2<u32>;\r\n@group(0) @binding(1) var diffuseTex : texture_2d<f32>;\r\n@group(0) @binding(2) var linearSampler : sampler;\r\n\r\n// g-buffer\r\n@group(1) @binding(0) var normalTex : texture_2d<f32>;\r\n@group(1) @binding(1) var albedoTex : texture_2d<f32>;\r\n@group(1) @binding(2) var outputTex : texture_storage_2d<rgba8unorm, write>;\r\n@group(1) @binding(3) var depthTex : texture_2d<f32>;\r\n\r\nconst SAMPLE_RADIUS = 2;\r\nconst SAMPLE_STEP = 1;\r\nconst GAUSSIAN_SIGMA = 0.5;\r\nconst DEPTH_THRESHOLD = 1.0;\r\n\r\n// Function to calculate the Gaussian weight\r\nfn gaussianWeight(offset: vec2<f32>) -> f32 {\r\n    let exponent = -dot(offset, offset) / (2.0 * GAUSSIAN_SIGMA * GAUSSIAN_SIGMA);\r\n    return exp(exponent) / (2.0 * 3.141592653589793 * GAUSSIAN_SIGMA * GAUSSIAN_SIGMA);\r\n}\r\n\r\n@compute @workgroup_size(8, 8, 1)\r\nfn main(\r\n  @builtin(global_invocation_id) GlobalInvocationID : vec3<u32>\r\n)\r\n{\r\n  var pixel = vec2<f32>(GlobalInvocationID.xy);\r\n  var normalSample = textureLoad(normalTex,GlobalInvocationID.xy, 0).rgb;\r\n  var albedoSample = textureLoad(albedoTex,GlobalInvocationID.xy, 0).rgb;\r\n  var depthSample = textureLoad(depthTex,GlobalInvocationID.xy, 0).r;\r\n\r\n  if(all(normalSample == vec3(0.0))) {\r\n    textureStore(\r\n      outputTex,\r\n      vec2<u32>(pixel),\r\n      vec4(normalSample,1.0),\r\n    );\r\n    return;\r\n  }\r\n\r\n  var outputSample = vec3(0.0);\r\n  var sampleCount = 0.0;\r\n\r\n  for(var x = -SAMPLE_RADIUS; x <= SAMPLE_RADIUS; x+=SAMPLE_STEP) {\r\n    for(var y = -SAMPLE_RADIUS; y <= SAMPLE_RADIUS; y += SAMPLE_STEP) {\r\n      let offset = vec2(f32(x),f32(y));\r\n      let weight = gaussianWeight(offset / f32(SAMPLE_RADIUS));\r\n      let currentPixel = pixel + offset;\r\n      let currentUV = vec2<f32>(currentPixel) / vec2<f32>(resolution);\r\n      let currentNormal = textureLoad(normalTex,vec2<u32>(currentPixel), 0).rgb;\r\n      let isWithinDepthThreshold = abs(depthSample - textureLoad(depthTex,vec2<u32>(currentPixel), 0).r) < DEPTH_THRESHOLD;\r\n      if(all(normalSample == currentNormal) && isWithinDepthThreshold) {\r\n        outputSample += weight * textureSampleLevel(diffuseTex, linearSampler, currentUV, 0.0).rgb;\r\n        sampleCount += weight;\r\n      }\r\n    }\r\n  }\r\n\r\n  outputSample /= sampleCount;\r\n  var outputColour = outputSample * albedoSample;\r\n  textureStore(\r\n    outputTex,\r\n    vec2<u32>(pixel),\r\n    vec4(outputColour,1.0),\r\n  );\r\n}"}),entryPoint:"main"}});let i;const c=()=>(i||(i=on.createTexture({size:[an[0],an[1],1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING})),i.createView());return{render:({commandEncoder:e,outputTextureViews:r,frustumCornerDirectionsBuffer:i,voxelTextureView:s,resolutionBuffer:a,cameraPositionBuffer:u,transformationMatrixBuffer:l,timeBuffer:p})=>{const h=e.beginComputePass(),d=on.createBindGroup({layout:t,entries:[{binding:0,resource:r.normalTextureView},{binding:1,resource:r.albedoTextureView},{binding:2,resource:r.finalTexture},{binding:3,resource:r.depthAndClusterTextureView}]}),m=on.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:a}},{binding:1,resource:s},{binding:2,resource:{buffer:i}},{binding:3,resource:{buffer:u}},{binding:4,resource:{buffer:l}},{binding:5,resource:on.createSampler({magFilter:"nearest",minFilter:"nearest"})},{binding:6,resource:c()},{binding:7,resource:{buffer:p}}]});h.setPipeline(o),h.setBindGroup(0,m),h.setBindGroup(1,d),h.dispatchWorkgroups(an[0]/8,an[1]/8);const f=on.createBindGroup({layout:n.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:a}},{binding:1,resource:c()},{binding:2,resource:on.createSampler({magFilter:"linear",minFilter:"linear"})}]});h.setPipeline(n),h.setBindGroup(0,f),h.setBindGroup(1,d),h.dispatchWorkgroups(an[0]/8,an[1]/8),h.end()}}},en={format:"rgba8unorm",usage:GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING,dimension:"3d"},rn=new class{maxObjectCount;objectCount;scale;targetScale;translateX;targetTranslateX;rotateY;targetRotateY;constructor(){this.maxObjectCount=3,this.objectCount=3,this.scale=1,this.translateX=0,this.targetScale=1,this.targetTranslateX=0,this.rotateY=0,this.targetRotateY=0}update(){or((t=>{const e=this.targetScale-this.scale;this.scale=this.scale+e*t}),{easing:ar({velocity:2e-4*hn})}),or((t=>{const e=this.targetTranslateX-this.translateX;this.translateX=this.translateX+e*t}),{easing:ar({velocity:2e-4*hn})}),or((t=>{const e=this.targetRotateY-this.rotateY;this.rotateY=this.rotateY+e*t}),{easing:ar({velocity:2e-4*hn})})}};let on,nn,sn,an=q.zero(),un=1;const cn=performance.now();let ln,pn=cn,hn=0,dn=new class extends ur{fieldOfView;near=.1;far=1e4;constructor(t){super({position:t.position,rotation:Wt.identity()}),this.fieldOfView=t.fieldOfView}get direction(){return ut.transformQuat(ut.create(0,0,1),this.rotation)}get right(){return ut.transformQuat(ut.create(1,0,0),this.rotation)}get left(){return ut.transformQuat(ut.create(-1,0,0),this.rotation)}get up(){return ut.transformQuat(ut.create(0,1,0),this.rotation)}get down(){return ut.transformQuat(ut.create(0,-1,0),this.rotation)}get viewMatrix(){const t=ut.add(this.position,this.direction);return Tt.lookAt(this.position,t,this.up)}get inverseViewMatrix(){return Tt.invert(this.viewMatrix)}get perspectiveMatrix(){return Tt.perspective(this.fieldOfView,an[0]/an[1],this.near,this.far)}get projectionMatrix(){return Tt.multiply(this.perspectiveMatrix,this.viewMatrix)}get inverseProjectionMatrix(){return Tt.invert(this.projectionMatrix)}get viewProjectionMatrix(){return Tt.mul(this.projectionMatrix,this.viewMatrix)}}({fieldOfView:80,position:ut.create(3.5,3.5,-6.8),direction:ut.normalize(ut.create(0,0,1))});const mn=new class{logElement;isMouseDown=!1;constructor(){document.getElementById("reset").addEventListener("click",(t=>{window.dispatchEvent(new CustomEvent("resetcamera")),document.getElementById("captures").innerHTML=""})),document.getElementById("capture").addEventListener("click",(t=>{const e=new Image;e.id=performance.now().toString(),e.src=sn.toDataURL(),document.getElementById("captures").appendChild(e).addEventListener("click",(t=>{t.target,console.log(t.target)}))})),["downscale","fov","scale","translate","objectcount"].forEach((t=>{document.getElementById(t).addEventListener("input",(e=>{const r=e.target;window.dispatchEvent(new CustomEvent(`change${t}`,{detail:r.value}))}))})),this.logElement=document.getElementById("log"),window.addEventListener("changefov",(t=>{dn.fieldOfView=parseFloat(t.detail)})),window.addEventListener("changetranslate",(t=>{rn.targetTranslateX=.01*parseFloat(t.detail)})),window.addEventListener("changescale",(t=>{rn.targetScale=parseFloat(t.detail)})),window.addEventListener("resetcamera",(()=>{rn.targetTranslateX=0,rn.targetScale=1,rn.targetRotateY=0})),window.addEventListener("changeobjectcount",(t=>{rn.objectCount=parseFloat(t.detail)})),document.getElementById("webgpu-canvas").addEventListener("mousedown",(()=>{this.isMouseDown=!0})),document.getElementById("webgpu-canvas").addEventListener("mouseup",(()=>{this.isMouseDown=!1})),document.getElementById("webgpu-canvas").addEventListener("mouseleave",(()=>{this.isMouseDown=!1})),window.addEventListener("mousemove",(t=>{this.isMouseDown&&(rn.targetRotateY-=.005*t.movementX)}))}log(t){this.logElement.innerText=t}};let fn,_n,gn;const yn=new Worker(new URL(r.p+r.u(136),r.b)),wn=(r,o)=>{let s,a,u,c,l,p,h,d,m,f;yn.addEventListener("message",(t=>{f?n(f,t.data):f=i(r,t.data,"voxel object")})),sn=document.getElementById("webgpu-canvas"),nn=sn.getContext("webgpu");const _=navigator.gpu.getPreferredCanvasFormat();nn.configure({device:r,format:_,usage:GPUTextureUsage.RENDER_ATTACHMENT});const g=()=>{clearInterval(h),cancelAnimationFrame(p),y()},y=()=>{const{clientWidth:t,clientHeight:e}=sn.parentElement;let r=Math.min(window.devicePixelRatio,1.5);const o=q.create(t*r,e*r);an=q.mulScalar(o,1/un),sn.width=o[0],sn.height=o[1],sn.style.transform=`scale(${1/r})`,p=requestAnimationFrame(x),h=setInterval(w,1e3/60)},w=()=>{o.forEach((({fixedUpdate:t})=>{t&&t()}))},x=async()=>{const n=performance.now()-cn;if(hn=n-pn,pn=n,yn.postMessage({maxObjectCount:rn.maxObjectCount,objectCount:rn.objectCount,scale:rn.scale,translateX:rn.translateX,rotateY:rn.rotateY,camera:dn,objectSize:[50,50,50]}),!f)return void(p=requestAnimationFrame(x));(()=>{const t=.03*hn;let e=ut.zero();cr.pressed.a&&(e=ut.add(e,dn.left)),cr.pressed.d&&(e=ut.add(e,dn.right)),cr.pressed.w&&(e=ut.add(e,dn.direction)),cr.pressed.s&&(e=ut.subtract(e,dn.direction)),cr.pressed[" "]&&(e=ut.add(e,dn.up)),cr.pressed.control&&(e=ut.add(e,dn.down)),e=ut.normalize(e),dn.targetPosition=ut.add(dn.targetPosition,ut.mulScalar(e,t))})(),dn.update(),rn.update(),mn.log(`\n      Direction: ${dn.direction[0].toFixed(1)}, ${dn.direction[1].toFixed(1)}, ${dn.direction[2].toFixed(1)}\n      Position: ${dn.position[0].toFixed(1)}, ${dn.position[1].toFixed(1)}, ${dn.position[2].toFixed(1)}\n    Resolution: ${an[0].toFixed(1)}x${an[1].toFixed(0)}\n    Frame Time: ${hn.toFixed(1)}ms\n    Object Count: ${rn.objectCount}\n    `);const h=r.createCommandEncoder();d?t(d,[pn]):d=e([pn]),m?t(m,[an[0],an[1]]):m=e([an[0],an[1]]);const _=(u||(u=r.createTexture({size:[an[0],an[1],1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING})),u.createView()),g=(s||(s=r.createTexture({size:[an[0],an[1],1],format:"rgba8snorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING})),s.createView()),y=(a||(a=r.createTexture({size:[an[0],an[1],1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING})),a.createView()),w=(c||(c=r.createTexture({size:[an[0],an[1],1],format:"r32float",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING})),c.createView()),v=(l||(l=r.createTexture({size:[an[0],an[1],1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING})),l.createView()),b=(t=>{const e=(t=>{const e=(t=>{const e=an[0]/an[1],r=2*Math.tan(t.fieldOfView/180*Math.PI/2)*t.near,o=r*e,n=ut.create(o/2,-r/2,-t.near),i=ut.create(-o/2,-r/2,-t.near),s=ut.create(-o/2,r/2,-t.near);return[ut.create(o/2,r/2,-t.near),s,n,i]})(t);return[ut.normalize(ut.subtract(e[0],ut.zero())),ut.normalize(ut.subtract(e[1],ut.zero())),ut.normalize(ut.subtract(e[2],ut.zero())),ut.normalize(ut.subtract(e[3],ut.zero()))]})(t),r=Wt.fromMat(t.inverseViewMatrix);return[ut.transformQuat(e[0],r),ut.transformQuat(e[1],r),ut.transformQuat(e[2],r),ut.transformQuat(e[3],r)]})(dn).flatMap((t=>[...t,0])),k=i(r,b,"frustum corner directions"),T=i(r,dn.position,"camera position");gn=ln.getAtlasTextureView(),o.forEach((({render:t})=>{t({commandEncoder:h,resolutionBuffer:m,timeBuffer:d,outputTextureViews:{finalTexture:_,albedoTextureView:y,normalTextureView:g,depthAndClusterTextureView:w,debugTextureView:v,skyTextureView:_n},frustumCornerDirectionsBuffer:k,cameraPositionBuffer:T,voxelTextureView:gn,transformationMatrixBuffer:f})})),r.queue.submit([h.finish()]),p=requestAnimationFrame(x)},v=new ResizeObserver(g);fn=t=>{un=t.detail,g()},window.addEventListener("changedownscale",fn),v.observe(sn.parentElement)};void 0!==navigator.gpu?navigator.gpu.requestAdapter().then((t=>{t.requestDevice().then((async t=>{on=t;const e=await Zo(on,["cubemaps/town-square/posx.jpg","cubemaps/town-square/negx.jpg","cubemaps/town-square/posy.jpg","cubemaps/town-square/negy.jpg","cubemaps/town-square/posz.jpg","cubemaps/town-square/negz.jpg"]);_n=e.createView({dimension:"cube"}),ln=(t=>{let e=null;return{addVolume:r=>{const{width:o,height:n,depthOrArrayLayers:i}=r;if(!e){const s=t.createCommandEncoder();return e=t.createTexture({size:{width:o,height:n,depthOrArrayLayers:i},...en,label:`Volume atlas containing ${r.label||"unnamed volume"}`}),s.copyTextureToTexture({texture:r,mipLevel:0,origin:{x:0,y:0,z:0}},{texture:e,mipLevel:0,origin:{x:e.width-o,y:0,z:0}},{width:o,height:n,depthOrArrayLayers:i}),void t.queue.submit([s.finish()])}const s=e.width+o;if(s>t.limits.maxTextureDimension3D)throw new Error(`Error adding volume to atlas: adding volume would exceed device max texture dimension of ${t.limits.maxTextureDimension3D}`);const a=e,u=t.createTexture({size:{width:s,height:Math.max(e.height,n),depthOrArrayLayers:Math.max(e.depthOrArrayLayers,i)},...en,label:`${e.label}, ${r.label||"unnamed volume"}`}),c=t.createCommandEncoder();c.copyTextureToTexture({texture:e},{texture:u},{width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers}),c.copyTextureToTexture({texture:r},{texture:u,origin:{x:u.width-o,y:0,z:0}},{width:o,height:n,depthOrArrayLayers:i}),t.queue.submit([c.finish()]),e=u,a.destroy()},removeVolume:(r,o)=>{if(!e)throw new Error("Error removing from atlas: No atlas texture to remove volume from");const n=ut.subtract(o,r);if(n[0]>e.width||n[1]>e.height||n[2]>e.depthOrArrayLayers)throw new Error(`Error removing from atlas: volume to remove (${n}) is larger than atlas texture (${e.width}, ${e.height}, ${e.depthOrArrayLayers})`);const i=t.createCommandEncoder(),s=i.beginComputePass(),a=t.createComputePipeline({layout:"auto",compute:{module:t.createShaderModule({code:"\n                @group(0) @binding(0) var texture : texture_storage_3d<rgba8unorm, write>;\n                override startX: u32 = 0;\n                override startY: u32 = 0;\n                override startZ: u32 = 0;\n                @compute @workgroup_size(1, 1, 1)\n                fn main(\n                  @builtin(global_invocation_id) GlobalInvocationID : vec3<u32>\n                ) {\n                  textureStore(texture, GlobalInvocationID + vec3(startX, startY, startZ), vec4(0.0));\n                }\n            "}),entryPoint:"main",constants:{startX:r[0],startY:r[1],startZ:r[2]}}});s.setPipeline(a),s.setBindGroup(0,t.createBindGroup({layout:a.getBindGroupLayout(0),entries:[{binding:0,resource:e.createView()}]})),s.dispatchWorkgroups(n[0],n[1],n[2]),s.end(),t.queue.submit([i.finish()])},getAtlasTextureView:()=>{const t=e.createView();return t.label=e.label,t}}})(on);const r=await Ko(on,pr().sliceFilePaths,pr().size,"cornell box");ln.addVolume(r),setTimeout((()=>{Ko(on,dr().sliceFilePaths,dr().size,"cube").then((t=>{ln.addVolume(t)}))}),1e3),wn(on,[await c(),await tn(),mr(on)])}))})):console.error("WebGPU not supported")})()})();